  <div class="card" >

    <div class="card" >
      <div class="flex align-items-center justify-content-between mb-0" >
        <h5 > <span style="color: orange; font-weight: bold;">VOS INFORMATIONS</span></h5>
      </div>
      <div class="card flex align-items-center justify-content-center flex-wrap gap-3" [style]="{'border': '1px solid orange'}">
        <div>
          <label for="code">Code : </label>
          <input type="text" name="code" size="20" pInputText [disabled]="true" 
                 [(ngModel)]="declarationData.assujetti.code" />
        </div>
      
        <div>
          <label for="nom">Nom : </label>
          <input type="text" name="nom" size="20" pInputText [disabled]="true"
                 [(ngModel)]="declarationData.assujetti.nom" />
        </div>
      
        <div>
          <label for="prenom">Prénom : </label>
          <input type="text" name="prenom" size="20" pInputText [disabled]="true"
                 [(ngModel)]="declarationData.assujetti.prenom" />  
        </div>
      
        <div>
          <label for="numdec">Numéro déclaration : </label>
          <input type="text" name="numdec" size="20" pInputText [disabled]="true"
                 [(ngModel)]="declarationData.numeroDeclaration" />
        </div>
      
    
        <div>
          <label for="typdec">Type de déclaration : </label>
          <input type="text" name="typdec" size="20" pInputText [disabled]="true"
                 [(ngModel)]="declarationData.typeDeclaration" />
        </div>
      
<div>
  <label for="dateprisedec">Date Prise de Service : </label>
  <input type="date" 
         name="dateprisedec" 
         size="50" 
         pInputText 
         [disabled]="true"
         [ngModel]="declarationData.assujetti.datePriseDeService | date:'yyyy-MM-dd'" />
</div>
      </div>
  </div>
                <img src="/assets/demo/images/logos/niger.png" >
  <div class="card" >
    <h5 > <span style="color: orange; font-weight: bold;">Declaration</span></h5>
    <p-accordion>
     <p-accordionTab header="Foncier bâti" (onOpen)="loadFonciersBati()" (onClose)="resetNatureFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des fonciers</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialog()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedFonciers.length"
                (click)="confirmDeleteSelected()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="foncierBatiTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedFonciers"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['nature','referencesCadastrales','localisation']"
            #dt>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="naturesBien" optionLabel="intitule" 
                        [(ngModel)]="selectedNature" [showClear]="true"
                        placeholder="Filtrer par nature" (onChange)="filterByNature()"
                        class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="nature">Nature <p-sortIcon field="nature"></p-sortIcon></th>
          <th pSortableColumn="anneeConstruction">Année <p-sortIcon field="anneeConstruction"></p-sortIcon></th>
          <th pSortableColumn="modeAcquisition">Acquisition <p-sortIcon field="modeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="referencesCadastrales">Cadastre <p-sortIcon field="referencesCadastrales"></p-sortIcon></th>
          <th pSortableColumn="superficie">Superficie <p-sortIcon field="superficie"></p-sortIcon></th>
          <th pSortableColumn="localisation">Localisation <p-sortIcon field="localisation"></p-sortIcon></th>
          <th pSortableColumn="typeUsage">Usage <p-sortIcon field="typeUsage"></p-sortIcon></th>
          <th pSortableColumn="nbrChambres">Chambres <p-sortIcon field="nbrChambres"></p-sortIcon></th>
          <th pSortableColumn="etatGeneral">État <p-sortIcon field="etatGeneral"></p-sortIcon></th>
          <th pSortableColumn="coutAcquisition">Coût Acq. <p-sortIcon field="coutAcquisition"></p-sortIcon></th>
          <th pSortableColumn="coutInvestissement">Investissements <p-sortIcon field="coutInvestissement"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-foncier>
        <tr [class.editing-row]="foncier.editing">
          <td><p-tableCheckbox [value]="foncier"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!foncier.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(foncier.nature) }}</span></td>
            <td>{{ foncier.anneeConstruction | date:'yyyy' }}</td>
            <td>{{ getIntitule(foncier.modeAcquisition) }}</td>
            <td>{{ foncier.referencesCadastrales }}</td>
            <td>{{ foncier.superficie | number }} m²</td>
            <td>{{ getIntitule(foncier.localisation) }}</td>
            <td>{{ getIntitule(foncier.typeUsage) }}</td>
            <td>{{ foncier.nbrChambres }}</td>
            <td>{{ getIntitule(foncier.etatGeneral) }}</td>
            <td class="font-bold text-right">{{ foncier.coutAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td class="text-right">{{ foncier.coutInvestissement | currency:'FCFA':'symbol':'1.0-0' }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="foncier.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="triggerFileUpload(foncier)"
                        pTooltip="{{foncier.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="!foncier.editing && foncier.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocument(foncier)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="foncier.hasDocument" class="document-name text-sm text-primary">
                  {{ foncier.fileName }}
                </span>
                <span *ngIf="!foncier.hasDocument" class="text-gray-500 text-sm">
                  {{ foncier.editing ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditFoncier(foncier)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="foncier.editing">
            <td>
              <p-dropdown [options]="naturesBien" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.nature" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-calendar [(ngModel)]="foncier.anneeConstruction" [appendTo]="'body'" 
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td>
              <p-dropdown [options]="modesAcquisition" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.modeAcquisition" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="foncier.referencesCadastrales" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.superficie" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="localisations" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.localisation" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="usages" [appendTo]="'body'" optionLabel="intitule" 
                        [(ngModel)]="foncier.typeUsage" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <input pInputText [(ngModel)]="foncier.nbrChambres" type="number" min="0" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="etatsGeneraux" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.etatGeneral" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="foncier.coutAcquisition" type="number" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.coutInvestissement" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <div class="flex align-items-center">
                <button *ngIf="showUploadForFoncierId === foncier.id"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                        (click)="showUploadDialog(foncier)" 
                        pTooltip="Modifier le document">
                </button>
                
                <button *ngIf="foncier.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocument(foncier)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="foncier.hasDocument" class="document-name text-sm text-primary">
                  {{ foncier.fileName }}
                </span>
                <span *ngIf="!foncier.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedFoncier(foncier)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditFoncier(foncier)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="14">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun foncier bâti trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{foncierBatiTemp ? foncierBatiTemp.length : 0}} fonciers
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUpload id="fileUpload" style="display:none" 
         (change)="onFileSelect($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog header="Ajouter un nouveau foncier" 
         [(visible)]="displayAddDialogfoncier" 
         [modal]="true"
         [draggable]="false" 
         [resizable]="false"
         [style]="{
           width: '70vw', 
           maxWidth: '800px', 
           fontSize: '1.2rem', 
           borderRadius: '16px',
         }"
         styleClass="p-3 surface-ground text-color border-round-xl"
         [baseZIndex]="10000">
  
  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau foncier</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="nature" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-tags mr-2 text-orange-500"></i>Nature<span class="text-danger">*</span>
        </label>
        <p-dropdown id="nature"
                  [options]="naturesBien" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowFoncier.nature" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowFoncier.nature ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowFoncier.nature">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{tableRowFoncier.nature.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowFoncier.nature" class="p-error block mt-1">La nature est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="annee" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Année de construction<span class="text-danger">*</span>
        </label>
        <p-calendar id="annee"
                  [(ngModel)]="tableRowFoncier.anneeConstruction" 
                  view="year" 
                  dateFormat="yy" 
                  [yearNavigator]="true" 
                  [required]="true"
                  placeholder="Année"
                  [yearRange]="'1900:2025'"
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowFoncier.anneeConstruction ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !tableRowFoncier.anneeConstruction" class="p-error block mt-1">L'année est requise</small>
      </div>
      
      <!-- Ligne 2 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="modeacq" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>Mode d'acquisition<span class="text-danger">*</span>
        </label>
        <p-dropdown id="modeacq"
                  [options]="modesAcquisition" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowFoncier.modeAcquisition" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowFoncier.modeAcquisition ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowFoncier.modeAcquisition">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{tableRowFoncier.modeAcquisition.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowFoncier.modeAcquisition" class="p-error block mt-1">Le mode d'acquisition est requis</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="refcad" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-id-card mr-2 text-orange-500"></i>Références cadastrales<span class="text-danger">*</span>
        </label>
        <input id="refcad" pInputText [(ngModel)]="tableRowFoncier.referencesCadastrales" class="w-full" 
               style="height: 40px;"
               [ngClass]="{'p-invalid': submitted && !tableRowFoncier.referencesCadastrales}" />
        <small *ngIf="submitted && !tableRowFoncier.referencesCadastrales" class="p-error block mt-1">Les références cadastrales sont requises</small>
      </div>
      
      <!-- Ligne 3 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="superficie" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-th-large mr-2 text-orange-500"></i>Superficie (m²)
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <input id="superficie" pInputText [(ngModel)]="tableRowFoncier.superficie" type="number" min="0" class="w-full" style="height: 40px;" />
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">m²</span>
        </div>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="localisation" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-map-marker mr-2 text-orange-500"></i>Localisation<span class="text-danger">*</span>
        </label>
        <p-dropdown id="localisation"
                  [options]="localisations" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowFoncier.localisation" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowFoncier.localisation ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowFoncier.localisation">
              <i class="pi pi-map-marker mr-2 text-orange-500"></i>
              <span>{{tableRowFoncier.localisation.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-map-marker mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowFoncier.localisation" class="p-error block mt-1">La localisation est requise</small>
      </div>
      
      <!-- Ligne 4 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="usage" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-home mr-2 text-orange-500"></i>Type d'usage<span class="text-danger">*</span>
        </label>
        <p-dropdown id="usage"
                  [options]="usages" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowFoncier.typeUsage" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowFoncier.typeUsage ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowFoncier.typeUsage">
              <i class="pi pi-home mr-2 text-orange-500"></i>
              <span>{{tableRowFoncier.typeUsage.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-home mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowFoncier.typeUsage" class="p-error block mt-1">Le type d'usage est requis</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="nbrChambres" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-building mr-2 text-orange-500"></i>Nombre de chambres
        </label>
        <input id="nbrChambres" pInputText [(ngModel)]="tableRowFoncier.nbrChambres" type="number" min="0" class="w-full" style="height: 40px;" />
      </div>
      
      <!-- Ligne 5 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="etatGeneral" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-star mr-2 text-orange-500"></i>État général
        </label>
        <p-dropdown id="etatGeneral"
          [options]="etatGeneral" 
          optionLabel="intitule" 
          [(ngModel)]="tableRowFoncier.etatGeneral" 
          placeholder="Sélectionner" 
          [required]="true" 
          class="w-full"
          [style]="{'border-color': submitted && !tableRowFoncier.etatGeneral ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowFoncier.etatGeneral">
              <i class="pi pi-star mr-2 text-orange-500"></i>
              <span>{{tableRowFoncier.etatGeneral.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-star mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="coutacq" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Coût d'acquisition (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="coutacq" pInputText [(ngModel)]="tableRowFoncier.coutAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !tableRowFoncier.coutAcquisition}" />
        </div>
        <small *ngIf="submitted && !tableRowFoncier.coutAcquisition" class="p-error block mt-1">Le coût d'acquisition est requis</small>
      </div>
      
      <!-- Ligne 6 -->
      <div class="field col-12 md:col-6 p-3">
        <label for="coutinv" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-chart-line mr-2 text-orange-500"></i>Investissements (FCFA)
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="coutinv" pInputText [(ngModel)]="tableRowFoncier.coutInvestissement" type="number" min="0" class="w-full" style="height: 40px;" />
        </div>
      </div>
      
      <!-- Ligne 7 - Champ unique sur toute la largeur -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton 
                  icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewFoncier()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="tableRowFoncier.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ tableRowFoncier.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFilefoncier()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddFoncier()"></button>
      <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddFoncier()"></button>
    </div>
  </ng-template>
</p-dialog>

<p-dialog header="Télécharger un document" 
         [(visible)]="displayUploadDialog" 
         [style]="{width: '450px'}" 
         [modal]="true" 
         [draggable]="false" 
         [resizable]="false"
         styleClass="custom-dialog">
  <ng-template pTemplate="header">
    <div class="w-full text-center" style="background: linear-gradient(to right, #ff7b00, #ff9e00);">
      <span class="text-white text-xl font-bold">Télécharger un document</span>
    </div>
  </ng-template>
  
  <div class="p-dialog-content">
    <div class="flex flex-column p-4 surface-card border-round-lg shadow-2">
      <label class="font-bold mb-2 text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
        <i class="pi pi-file-import mr-2 text-orange-500"></i>Sélectionner un fichier
      </label>
      <div class="p-field-file">
        <div class="py-3 px-4 border-1 border-dashed border-orange-500 border-round mb-2 text-center cursor-pointer hover:bg-orange-50 transition-colors transition-duration-300" 
             (click)="fileInput.click()" 
             (dragover)="$event.preventDefault()" 
             (drop)="handleFileDrop($event)">
          <span class="flex flex-column align-items-center">
            <i class="pi pi-cloud-upload text-5xl text-orange-500 mb-2"></i>
            <span class="text-orange-500">Glisser et déposer un fichier ici ou cliquer pour parcourir</span>
            <span class="text-sm text-orange-300 mt-1">
              (.pdf, .doc, .docx, .jpg, .jpeg, .png) - max 5 MB
            </span>
          </span>
        </div>
        <input #fileInput type="file" (change)="onFileSelect($event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
               style="display:none;" />
      </div>
      <div *ngIf="selectedFile" class="mt-3 flex align-items-center bg-orange-50 p-2 border-round">
        <i class="pi pi-file text-orange-500 mr-2"></i>
        <span class="text-orange-500">{{ selectedFile.name }}</span>
        <span class="text-sm text-orange-300 ml-2">({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)</span>
      </div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelUpload()"></button>
      <button pButton label="Télécharger" icon="pi pi-upload" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;"
              [disabled]="!selectedFile"
              (click)="uploadFile()"></button>
    </div>
  </ng-template>
</p-dialog>

<style>
:host ::ng-deep .centered-dialog {
  text-align: center;
}

:host ::ng-deep .centered-dialog .p-dialog-header {
  justify-content: center;
}

:host ::ng-deep .centered-dialog .p-dialog-content {
  text-align: center;
}

:host ::ng-deep .centered-dialog .p-dialog-footer {
  justify-content: center;
  display: flex;
  flex-direction: row;
}

:host ::ng-deep .order-first {
  order: 1;
}

:host ::ng-deep .order-last {
  order: 2;
}
:host ::ng-deep .centered-dialog .p-confirm-dialog-accept {
  background-color: #10b981;
  border-color: #10b981;
}

:host ::ng-deep .centered-dialog .p-confirm-dialog-accept:hover {
  background-color: #059669;
  border-color: #059669;
}

:host ::ng-deep .centered-dialog .p-confirm-dialog-reject {
  background-color: #f4a261; /* Orange doux avec nuance verte */
  border-color: #f4a261;
}

:host ::ng-deep .centered-dialog .p-confirm-dialog-reject:hover {
  background-color: #e76f51; 
  border-color: #e76f51;
}


</style>

<p-toast [style]="{marginTop: '80px'}" position="top-right"></p-toast>

<p-accordionTab header="Foncier non bâti" (onOpen)="loadFonciersNonBati()" (onClose)="resetNatureFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des fonciers non bâtis</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogfnb()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedFoncierNonBati?.length"
                (click)="confirmDeleteSelected()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="foncierNonBatiTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedFoncierNonBati"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['nature','localite','titrePropriete']"
            #dtNonBati>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="naturesNonBati" optionLabel="intitule" 
                      [(ngModel)]="selectedNatureNonBati" [showClear]="true"
                      placeholder="Filtrer par nature" (onChange)="filterByNatureNonBati()"
                      class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="nature">Nature <p-sortIcon field="nature"></p-sortIcon></th>
          <th pSortableColumn="typeTerrain">Type terrain <p-sortIcon field="typeTerrain"></p-sortIcon></th>
          <th pSortableColumn="modeAcquisition">Acquisition <p-sortIcon field="modeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="ilot">Ilot <p-sortIcon field="ilot"></p-sortIcon></th>
          <th pSortableColumn="lotissement">Lotissement <p-sortIcon field="lotissement"></p-sortIcon></th>
          <th pSortableColumn="superficie">Superficie <p-sortIcon field="superficie"></p-sortIcon></th>
          <th pSortableColumn="localite">Localité <p-sortIcon field="localite"></p-sortIcon></th>
          <th pSortableColumn="titrePropriete">Titre propriété <p-sortIcon field="titrePropriete"></p-sortIcon></th>
          <th pSortableColumn="dateAcquis">Date acquis. <p-sortIcon field="dateAcquis"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisFCFA">Coût Acq. <p-sortIcon field="valeurAcquisFCFA"></p-sortIcon></th>
          <th pSortableColumn="coutInvestissement">Investissements <p-sortIcon field="coutInvestissement"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-foncier>
        <tr [class.editing-row]="foncier.editing">
          <td><p-tableCheckbox [value]="foncier"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!foncier.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(foncier.nature) }}</span></td>
            <td>{{ getIntitule(foncier.typeTerrain) }}</td>
            <td>{{ getIntitule(foncier.modeAcquisition) }}</td>
            <td>{{ foncier.ilot }}</td>
            <td>{{ foncier.lotissement }}</td>
            <td>{{ foncier.superficie | number }} m²</td>
            <td>{{ foncier.localite }}</td>
            <td>{{ foncier.titrePropriete }}</td>
            <td>{{ foncier.dateAcquis | date:'dd/MM/yyyy' }}</td>
            <td class="font-bold text-right">{{ foncier.valeurAcquisFCFA | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td class="text-right">{{ foncier.coutInvestissement | currency:'FCFA':'symbol':'1.0-0' }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="foncier.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="triggerFileUploadNonBati(foncier)"
                        pTooltip="{{foncier.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="!foncier.editing && foncier.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentNonBati(foncier)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="foncier.hasDocument" class="document-name text-sm text-primary">
                  {{ foncier.fileName }}
                </span>
                <span *ngIf="!foncier.hasDocument" class="text-gray-500 text-sm">
                  {{ foncier.editing ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditFoncierNonBati(foncier)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="foncier.editing">
            <td>
              <p-dropdown [options]="naturesNonBati" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.nature" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="typesTerrain" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.typeTerrain" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="modesAcquisition" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="foncier.modeAcquisition" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="foncier.ilot" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.lotissement" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.superficie" type="number" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.localite" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.titrePropriete" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-calendar [(ngModel)]="foncier.dateAcquis" [appendTo]="'body'"
                        [showIcon]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td><input pInputText [(ngModel)]="foncier.valeurAcquisFCFA" type="number" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="foncier.coutInvestissement" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <div class="flex align-items-center">
                <button *ngIf="foncier.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                        (click)="triggerFileUploadNonBati(foncier)" 
                        pTooltip="{{foncier.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="foncier.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentNonBati(foncier)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="foncier.hasDocument" class="document-name text-sm text-primary">
                  {{ foncier.fileName }}
                </span>
                <span *ngIf="!foncier.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedFoncierNonBati(foncier)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditFoncierNonBati(foncier)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="14">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun foncier non bâti trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{foncierNonBatiTemp ? foncierNonBatiTemp.length : 0}} fonciers
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUploadNonBati id="fileUploadNonBati" style="display:none" 
         (change)="onFileSelectNonBati($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="foncier-nonbati-dialog"
  header="Ajouter un nouveau foncier non bâti" 
  [(visible)]="displayAddDialogNonBati"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau foncier non bâti</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Nature et Type de terrain -->
      <div class="field col-12 md:col-6 p-3">
        <label for="natureNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-tags mr-2 text-orange-500"></i>Nature du terrain<span class="text-danger">*</span>
        </label>
        <p-dropdown id="natureNonBati"
                  [options]="naturesNonBati" 
                  optionLabel="intitule" 
                  [(ngModel)]="newFoncierNonBati.nature" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newFoncierNonBati.nature ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newFoncierNonBati.nature">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{newFoncierNonBati.nature.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newFoncierNonBati.nature" class="p-error block mt-1">La nature du terrain est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="typeTerrainNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-map mr-2 text-orange-500"></i>Type de terrain<span class="text-danger">*</span>
        </label>
        <p-dropdown id="typeTerrainNonBati"
                  [options]="typesTerrain" 
                  optionLabel="intitule" 
                  [(ngModel)]="newFoncierNonBati.typeTerrain" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newFoncierNonBati.typeTerrain ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newFoncierNonBati.typeTerrain">
              <i class="pi pi-map mr-2 text-orange-500"></i>
              <span>{{newFoncierNonBati.typeTerrain.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-map mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newFoncierNonBati.typeTerrain" class="p-error block mt-1">Le type de terrain est requis</small>
      </div>

      <!-- Ligne 2 - Mode d'acquisition et Ilot -->
      <div class="field col-12 md:col-6 p-3">
        <label for="modeacqNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>Mode d'acquisition<span class="text-danger">*</span>
        </label>
        <p-dropdown id="modeacqNonBati"
                  [options]="modesAcquisition" 
                  optionLabel="intitule" 
                  [(ngModel)]="newFoncierNonBati.modeAcquisition" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newFoncierNonBati.modeAcquisition ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newFoncierNonBati.modeAcquisition">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{newFoncierNonBati.modeAcquisition.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newFoncierNonBati.modeAcquisition" class="p-error block mt-1">Le mode d'acquisition est requis</small>
      </div>

      <div class="field col-12 md:col-6 p-3">
        <label for="ilotNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-map mr-2 text-orange-500"></i>Ilot
        </label>
        <input id="ilotNonBati" pInputText [(ngModel)]="newFoncierNonBati.ilot" class="w-full" 
               style="height: 40px;" />
      </div>

      <!-- Ligne 3 - Lotissement et Superficie -->
      <div class="field col-12 md:col-6 p-3">
        <label for="lotissementNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-map-marker mr-2 text-orange-500"></i>Lotissement
        </label>
        <input id="lotissementNonBati" pInputText [(ngModel)]="newFoncierNonBati.lotissement" class="w-full" 
               style="height: 40px;" />
      </div>

      <div class="field col-12 md:col-6 p-3">
        <label for="superficieNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-th-large mr-2 text-orange-500"></i>Superficie (m²)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <input id="superficieNonBati" pInputText [(ngModel)]="newFoncierNonBati.superficie" type="number" min="0" class="w-full" 
                 style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newFoncierNonBati.superficie}" />
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">m²</span>
        </div>
        <small *ngIf="submitted && !newFoncierNonBati.superficie" class="p-error block mt-1">La superficie est requise</small>
      </div>

      <!-- Ligne 4 - Localité et Titre de propriété -->
      <div class="field col-12 md:col-6 p-3">
        <label for="localiteNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-globe mr-2 text-orange-500"></i>Localité<span class="text-danger">*</span>
        </label>
        <input id="localiteNonBati" pInputText [(ngModel)]="newFoncierNonBati.localite" class="w-full" 
               style="height: 40px;"
               [ngClass]="{'p-invalid': submitted && !newFoncierNonBati.localite}" />
        <small *ngIf="submitted && !newFoncierNonBati.localite" class="p-error block mt-1">La localité est requise</small>
      </div>

      <div class="field col-12 md:col-6 p-3">
        <label for="titreProprieteNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-id-card mr-2 text-orange-500"></i>Titre de propriété
        </label>
        <input id="titreProprieteNonBati" pInputText [(ngModel)]="newFoncierNonBati.titrePropriete" class="w-full" 
               style="height: 40px;" />
      </div>

      <!-- Ligne 5 - Date d'acquisition et Valeur d'acquisition -->
      <div class="field col-12 md:col-6 p-3">
        <label for="dateAcquisNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Date d'acquisition<span class="text-danger">*</span>
        </label>
        <p-calendar id="dateAcquisNonBati"
                  [(ngModel)]="newFoncierNonBati.dateAcquis" 
                  [appendTo]="'body'"
                  [showIcon]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newFoncierNonBati.dateAcquis ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !newFoncierNonBati.dateAcquis" class="p-error block mt-1">La date d'acquisition est requise</small>
      </div>

      <div class="field col-12 md:col-6 p-3">
        <label for="valeurAcquisNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="valeurAcquisNonBati" pInputText [(ngModel)]="newFoncierNonBati.valeurAcquisFCFA" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newFoncierNonBati.valeurAcquisFCFA}" />
        </div>
        <small *ngIf="submitted && !newFoncierNonBati.valeurAcquisFCFA" class="p-error block mt-1">La valeur d'acquisition est requise</small>
      </div>

      <!-- Ligne 6 - Coût d'investissement et Documents -->
      <div class="field col-12 md:col-6 p-3">
        <label for="coutInvNonBati" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-chart-line mr-2 text-orange-500"></i>Coût d'investissement (FCFA)
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="coutInvNonBati" pInputText [(ngModel)]="newFoncierNonBati.coutInvestissement" type="number" min="0" class="w-full" style="height: 40px;" />
        </div>
      </div>

      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewFoncierNonBati()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="newFoncierNonBati.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ newFoncierNonBati.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileNonBati()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddFoncierNonBati()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddFoncierNonBati()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="MeubleMeublant" (onOpen)="loadMeublesMeublants()" (onClose)="resetMeubleFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des meubles meublants</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogMeuble()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedMeublesMeublant.length"
                (click)="confirmDeleteSelectedMeubles()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="meublesMeublantTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedMeublesMeublant"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['designation','etatGeneral']"
            #dtMeuble>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="designation" optionLabel="intitule" 
                      [(ngModel)]="selectedDesignation" [showClear]="true"
                      placeholder="Filtrer par désignation" (onChange)="filterByDesignation()"
                      class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="designation">Désignation <p-sortIcon field="designation"></p-sortIcon></th>
          <th pSortableColumn="anneeAcquisition">Année acquisition <p-sortIcon field="anneeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisition">Valeur acquis. <p-sortIcon field="valeurAcquisition"></p-sortIcon></th>
          <th pSortableColumn="etatGeneral">État général <p-sortIcon field="etatGeneral"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-meuble>
        <tr [class.editing-row]="meuble.editing">
          <td><p-tableCheckbox [value]="meuble"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!meuble.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(meuble.designation) }}</span></td>
            <td>{{ meuble.anneeAcquisition | date:'yyyy' }}</td>
            <td class="font-bold text-right">{{ meuble.valeurAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(meuble.etatGeneral) }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="meuble.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentMeuble(meuble)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="meuble.hasDocument" class="document-name text-sm text-primary">
                  {{ meuble.fileName }}
                </span>
                <span *ngIf="!meuble.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditMeuble(meuble)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="meuble.editing">
            <td>
              <p-dropdown [options]="designations" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="meuble.designation" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-calendar [(ngModel)]="meuble.anneeAcquisition" [appendTo]="'body'"
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td><input pInputText [(ngModel)]="meuble.valeurAcquisition" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="etatsGeneraux" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="meuble.etatGeneral" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="flex align-items-center">
                <button *ngIf="showUploadForMeubleId === meuble.id"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                        (click)="showUploadDialogMeuble(meuble)" 
                        pTooltip="Modifier le document">
                </button>
                
                <button *ngIf="meuble.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentMeuble(meuble)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="meuble.hasDocument" class="document-name text-sm text-primary">
                  {{ meuble.fileName }}
                </span>
                <span *ngIf="!meuble.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedMeuble(meuble)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditMeuble(meuble)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun meuble meublant trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{meublesMeublantTemp ? meublesMeublantTemp.length : 0}} meubles
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUploadMeuble id="fileUploadMeuble" style="display:none" 
         (change)="onFileSelectMeuble($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="meuble-dialog"
  header="Ajouter un nouveau meuble meublant" 
  [(visible)]="displayAddDialogMeuble"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau meuble meublant</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Désignation et État général -->
      <div class="field col-12 md:col-6 p-3">
        <label for="designationMeuble" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-tags mr-2 text-orange-500"></i>Désignation<span class="text-danger">*</span>
        </label>
        <p-dropdown id="designationMeuble"
                  [options]="designation" 
                  optionLabel="intitule" 
                  [(ngModel)]="newMeuble.designation" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newMeuble.designation ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newMeuble.designation">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{newMeuble.designation.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newMeuble.designation" class="p-error block mt-1">La désignation est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="etatMeuble" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-check-circle mr-2 text-orange-500"></i>État général<span class="text-danger">*</span>
        </label>
        <p-dropdown id="etatMeuble"
                  [options]="etatsGeneraux" 
                  optionLabel="intitule" 
                  [(ngModel)]="newMeuble.etatGeneral" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newMeuble.etatGeneral ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newMeuble.etatGeneral">
              <i class="pi pi-check-circle mr-2 text-orange-500"></i>
              <span>{{newMeuble.etatGeneral.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-check-circle mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newMeuble.etatGeneral" class="p-error block mt-1">L'état général est requis</small>
      </div>

      <!-- Ligne 2 - Année d'acquisition et Valeur d'acquisition -->
      <div class="field col-12 md:col-6 p-3">
        <label for="anneeAcquisitionMeuble" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Année d'acquisition<span class="text-danger">*</span>
        </label>
        <p-calendar id="anneeAcquisitionMeuble"
                  [(ngModel)]="newMeuble.anneeAcquisition" 
                  [appendTo]="'body'"
                  view="year" 
                  dateFormat="yy"
                  [yearNavigator]="true"
                  class="w-full"
                  [style]="{'border-color': submitted && !newMeuble.anneeAcquisition ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !newMeuble.anneeAcquisition" class="p-error block mt-1">L'année d'acquisition est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="valeurAcquisitionMeuble" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="valeurAcquisitionMeuble" pInputText [(ngModel)]="newMeuble.valeurAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newMeuble.valeurAcquisition}" />
        </div>
        <small *ngIf="submitted && !newMeuble.valeurAcquisition" class="p-error block mt-1">La valeur d'acquisition est requise</small>
      </div>

      <!-- Ligne 3 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewMeuble()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="newMeuble.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ newMeuble.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileMeuble()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddMeuble()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddMeuble()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="Appareil Électroménager" (onOpen)="loadAppareilsFromDeclaration()" (onClose)="resetAppareilFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des appareils électroménagers</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogAppareil()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedAppareilsElectromenager.length"
                (click)="confirmDeleteSelectedAppareils()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="appareilsElectromenagerTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedAppareilsElectromenager"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['designation','etatGeneral']"
            #dtAppareil>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="designationappareil" optionLabel="intitule" 
                      [(ngModel)]="selectedDesignationA" [showClear]="true"
                      placeholder="Filtrer par désignation" (onChange)="filterByDesignationAp()"
                      class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="designation">Désignation <p-sortIcon field="designation"></p-sortIcon></th>
          <th pSortableColumn="anneeAcquisition">Année acquisition <p-sortIcon field="anneeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisition">Valeur acquis. <p-sortIcon field="valeurAcquisition"></p-sortIcon></th>
          <th pSortableColumn="etatGeneral">État général <p-sortIcon field="etatGeneral"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-appareil>
        <tr [class.editing-row]="appareil.editing">
          <td><p-tableCheckbox [value]="appareil"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!appareil.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(appareil.designation) }}</span></td>
            <td>{{ appareil.anneeAcquisition | date:'yyyy' }}</td>
            <td class="font-bold text-right">{{ appareil.valeurAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(appareil.etatGeneral) }}</td>
            
           <td>
  <div class="flex align-items-center">
    <!-- Toujours afficher le bouton d'upload en mode édition -->
    <button pButton icon="pi pi-upload" 
            class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
            (click)="showUploadDialogAppareil(appareil)" 
            pTooltip="Modifier le document">
    </button>
    
    <button *ngIf="appareil.hasDocument" 
            pButton icon="pi pi-download" 
            class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
            (click)="downloadDocumentAppareil(appareil)"
            pTooltip="Télécharger le document"></button>
    
    <span *ngIf="appareil.hasDocument" class="document-name text-sm text-primary">
      {{ appareil.fileName }}
    </span>
    <span *ngIf="!appareil.hasDocument" class="text-gray-500 text-sm">
      Aucun document
    </span>
  </div>
</td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditAppareil(appareil)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="appareil.editing">
            <td>
              <p-dropdown [options]="designationappareil" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="appareil.designation" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-calendar [(ngModel)]="appareil.anneeAcquisition" [appendTo]="'body'"
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td><input pInputText [(ngModel)]="appareil.valeurAcquisition" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="etatsGeneraux" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="appareil.etatGeneral" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="flex align-items-center">
                <button *ngIf="showUploadForAppareilId === appareil.id"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                        (click)="showUploadDialogAppareil(appareil)" 
                        pTooltip="Modifier le document">
                </button>
                
                <button *ngIf="appareil.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentAppareil(appareil)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="appareil.hasDocument" class="document-name text-sm text-primary">
                  {{ appareil.fileName }}
                </span>
                <span *ngIf="!appareil.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedAppareil(appareil)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditAppareil(appareil)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun appareil électroménager trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{appareilsElectromenagerTemp ? appareilsElectromenagerTemp.length : 0}} appareils
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUploadAppareil id="fileUploadAppareil" style="display:none" 
         (change)="onFileSelectAppareil($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="appareil-dialog"
  header="Ajouter un nouvel appareil électroménager" 
  [(visible)]="displayAddDialogAppareil"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouvel appareil électroménager</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Désignation et État général -->
      <div class="field col-12 md:col-6 p-3">
        <label for="designationAppareil" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-tags mr-2 text-orange-500"></i>Désignation<span class="text-danger">*</span>
        </label>
        <p-dropdown id="designationAppareil"
                  [options]="designationappareil" 
                  optionLabel="intitule" 
                  [(ngModel)]="newAppareil.designation" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newAppareil.designation ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newAppareil.designation">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{newAppareil.designation.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-tag mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newAppareil.designation" class="p-error block mt-1">La désignation est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="etatAppareil" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-check-circle mr-2 text-orange-500"></i>État général<span class="text-danger">*</span>
        </label>
        <p-dropdown id="etatAppareil"
                  [options]="etatsGeneraux" 
                  optionLabel="intitule" 
                  [(ngModel)]="newAppareil.etatGeneral" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newAppareil.etatGeneral ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newAppareil.etatGeneral">
              <i class="pi pi-check-circle mr-2 text-orange-500"></i>
              <span>{{newAppareil.etatGeneral.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-check-circle mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newAppareil.etatGeneral" class="p-error block mt-1">L'état général est requis</small>
      </div>

      <!-- Ligne 2 - Année d'acquisition et Valeur d'acquisition -->
      <div class="field col-12 md:col-6 p-3">
        <label for="anneeAcquisitionAppareil" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Année d'acquisition<span class="text-danger">*</span>
        </label>
        <p-calendar id="anneeAcquisitionAppareil"
                  [(ngModel)]="newAppareil.anneeAcquisition" 
                  [appendTo]="'body'"
                  view="year" 
                  dateFormat="yy"
                  [yearNavigator]="true"
                  class="w-full"
                  [style]="{'border-color': submitted && !newAppareil.anneeAcquisition ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !newAppareil.anneeAcquisition" class="p-error block mt-1">L'année d'acquisition est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="valeurAcquisitionAppareil" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="valeurAcquisitionAppareil" pInputText [(ngModel)]="newAppareil.valeurAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newAppareil.valeurAcquisition}" />
        </div>
        <small *ngIf="submitted && !newAppareil.valeurAcquisition" class="p-error block mt-1">La valeur d'acquisition est requise</small>
      </div>

      <!-- Ligne 3 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewAppareil()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="newAppareil.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ newAppareil.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileAppareil()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddAppareil()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddAppareil()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="Animaux" (onOpen)="loadAnimaux()" (onClose)="resetAnimalFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des animaux</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogAnimal()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedAnimals.length"
                (click)="confirmDeleteSelectedAnimals()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="animauxTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedAnimals"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['espece','localiteanimalex.intitule']"
            #dtAnimal>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
             
    
              <input 
              pInputText 
              type="text" 
              (input)="searchAnimaux($any($event.target).value)" 
              placeholder="Rechercher par espèce..."
            />        </span>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="espece">Espèce <p-sortIcon field="espece"></p-sortIcon></th>
          <th pSortableColumn="nombreTetes">Nombre <p-sortIcon field="nombreTetes"></p-sortIcon></th>
          <th pSortableColumn="modeAcquisition.intitule">Mode acquisition <p-sortIcon field="modeAcquisition.intitule"></p-sortIcon></th>
          <th pSortableColumn="anneeAcquisition">Année <p-sortIcon field="anneeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisition">Valeur <p-sortIcon field="valeurAcquisition"></p-sortIcon></th>
          <th pSortableColumn="localiteanimalex.intitule">Localité <p-sortIcon field="localiteanimalex.intitule"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-animal>
        <tr [class.editing-row]="animal.editing">
          <td><p-tableCheckbox [value]="animal"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!animal.editing">
            <td><span [class.font-medium]="true">{{ animal.especes }}</span></td>
            <td>{{ animal.nombreTetes }}</td>
            <td>{{ animal.modeAcquisition?.intitule }}</td>
            <td>{{ animal.anneeAcquisition | date:'yyyy' }}</td>
            <td class="font-bold text-right">{{ animal.valeurAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ animal.localiteanimalex?.intitule }}</td>
            <td>
              <div class="flex align-items-center">
                <!-- Bouton d'upload visible seulement en mode édition -->
                <button *ngIf="animal.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="triggerFileUploadAnimal(animal)"
                        pTooltip="{{animal.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <!-- Bouton de téléchargement visible hors édition -->
                <button *ngIf="!animal.editing && animal.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentAnimal(animal)"
                        pTooltip="Télécharger le document"></button>
                
                <!-- Nom du document ou message -->
                <span *ngIf="animal.fileName" class="document-name text-sm text-primary">
                  {{ animal.fileName }}
                </span>
                <span *ngIf="!animal.fileName" class="text-gray-500 text-sm">
                  {{ animal.editing ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <!-- Input file caché (à placer en dehors du tableau) -->
            <input type="file" #fileInputAnimal style="display: none" 
                   (change)="onFileSelectAnimal($event)"
                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditAnimal(animal)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="animal.editing">
            <td>
              <input pInputText [(ngModel)]="animal.especes" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <input pInputText [(ngModel)]="animal.nombreTetes" type="number" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="modesAcquisition" optionLabel="intitule" [appendTo]="'body'"
                        [(ngModel)]="animal.modeAcquisition" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-calendar [(ngModel)]="animal.anneeAcquisition" [appendTo]="'body'"
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td>
              <input pInputText [(ngModel)]="animal.valeurAcquisition" type="number" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="localites" optionLabel="intitule" [appendTo]="'body'"
                        [(ngModel)]="animal.localiteanimalex" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="flex align-items-center">
<button *ngIf="showUploadForAnimalId === animal.id"
        pButton icon="pi pi-upload" 
        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
        (click)="triggerFileUploadAnimal(animal)" 
        pTooltip="{{animal.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
</button>
                
                <button *ngIf="animal.fileName" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentAnimal(animal)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="animal.fileName" class="document-name text-sm text-primary">
                  {{ animal.fileName }}
                </span>
                <span *ngIf="!animal.fileName" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedAnimal(animal)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditAnimal(animal)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="10">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun animal trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{animauxTemp ? animauxTemp.length : 0}} animaux
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileInputAnimal id="fileInputAnimal" style="display:none" 
         (change)="onFileSelectAnimal($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="animal-dialog"
  header="Ajouter un nouvel animal" 
  [(visible)]="displayAddDialogAnimal"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouvel animal</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Espèce et Race -->
      <div class="field col-12 md:col-6 p-3">
        <label for="especeAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-tags mr-2 text-orange-500"></i>Espèce<span class="text-danger">*</span>
        </label>
        <input pInputText id="especeAnimal"
              [(ngModel)]="newAnimal.especes" 
              placeholder="Entrez l'espèce" 
              [required]="true" 
              class="w-full"
              [style]="{'border-color': submitted && !newAnimal.especes ? '#f87171' : '', 'height': '40px'}">
        <small *ngIf="submitted && !newAnimal.especes" class="p-error block mt-1">L'espèce est requise</small>
      </div>
      
    
      <!-- Ligne 2 - Nombre de têtes et Mode acquisition -->
      <div class="field col-12 md:col-6 p-3">
        <label for="nombreTetesAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-check-circle mr-2 text-orange-500"></i>Nombre de têtes<span class="text-danger">*</span>
        </label>
        <input pInputText id="nombreTetesAnimal"
              [(ngModel)]="newAnimal.nombreTetes" 
              type="number" 
              placeholder="Nombre" 
              [required]="true" 
              class="w-full"
              [style]="{'border-color': submitted && !newAnimal.nombreTetes ? '#f87171' : '', 'height': '40px'}">
        <small *ngIf="submitted && !newAnimal.nombreTetes" class="p-error block mt-1">Le nombre de têtes est requis</small>
      </div>

      <div class="field col-12 md:col-6 p-3">
        <label for="modeAcquisitionAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>Mode d'acquisition<span class="text-danger">*</span>
        </label>
        <p-dropdown id="modeAcquisitionAnimal"
                  [options]="modesAcquisition" 
                  optionLabel="intitule" 
                  [(ngModel)]="newAnimal.modeAcquisition" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newAnimal.modeAcquisition ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newAnimal.modeAcquisition">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{newAnimal.modeAcquisition.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-shopping-cart mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newAnimal.modeAcquisition" class="p-error block mt-1">Le mode d'acquisition est requis</small>
      </div>

      <!-- Ligne 3 - Année d'acquisition et Valeur d'acquisition -->
      <div class="field col-12 md:col-6 p-3">
        <label for="anneeAcquisitionAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Année d'acquisition<span class="text-danger">*</span>
        </label>
        <p-calendar id="anneeAcquisitionAnimal"
                  [(ngModel)]="newAnimal.anneeAcquisition" 
                  [appendTo]="'body'"
                  view="year" 
                  dateFormat="yy"
                  [yearNavigator]="true"
                  class="w-full"
                  [style]="{'border-color': submitted && !newAnimal.anneeAcquisition ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !newAnimal.anneeAcquisition" class="p-error block mt-1">L'année d'acquisition est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="valeurAcquisitionAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="valeurAcquisitionAnimal" pInputText [(ngModel)]="newAnimal.valeurAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newAnimal.valeurAcquisition}" />
        </div>
        <small *ngIf="submitted && !newAnimal.valeurAcquisition" class="p-error block mt-1">La valeur d'acquisition est requise</small>
      </div>

      <!-- Ligne 4 - Localité -->
      <div class="field col-12 md:col-6 p-3">
        <label for="localiteAnimal" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-map-marker mr-2 text-orange-500"></i>Localité<span class="text-danger">*</span>
        </label>
        <p-dropdown id="localiteAnimal"
                  [options]="localites" 
                  optionLabel="intitule" 
                  [(ngModel)]="newAnimal.localiteanimalex" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newAnimal.localiteanimalex ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newAnimal.localiteanimalex">
              <i class="pi pi-map-marker mr-2 text-orange-500"></i>
              <span>{{newAnimal.localiteanimalex.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-map-marker mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newAnimal.localiteanimalex" class="p-error block mt-1">La localité est requise</small>
      </div>

      <!-- Ligne 5 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewAnimal()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="newAnimal.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ newAnimal.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileAnimal()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddAnimal()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddAnimal()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="Emprunt" (onOpen)="loadEmprunts()" (onClose)="resetEmpruntFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des emprunts</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogEmprunt()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedEmprunts.length"
                (click)="confirmDeleteSelectedEmprunts()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="empruntsTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedEmprunts"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['institutionFinanciere.intitule','typeEmprunt.intitule','numeroCompte']"
            #dtEmprunt>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="institutionFinanciere" optionLabel="intitule" 
                      [(ngModel)]="selectedInstitution" [showClear]="true"
                      placeholder="Filtrer par institution" (onChange)="filterByInstitution()"
                      class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="institutionFinanciere.intitule">Institution <p-sortIcon field="institutionFinanciere.intitule"></p-sortIcon></th>
          <th pSortableColumn="numeroCompte">N° Compte <p-sortIcon field="numeroCompte"></p-sortIcon></th>
          <th pSortableColumn="typeEmprunt.intitule">Type emprunt <p-sortIcon field="typeEmprunt.intitule"></p-sortIcon></th>
          <th pSortableColumn="montantEmprunt">Montant <p-sortIcon field="montantEmprunt"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-emprunt>
        <tr [class.editing-row]="emprunt.editing">
          <td><p-tableCheckbox [value]="emprunt"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!emprunt.editing">
            <td><span [class.font-medium]="true">{{ emprunt.institutionFinanciere?.intitule }}</span></td>
            <td>{{ emprunt.numeroCompte }}</td>
            <td>{{ emprunt.typeEmprunt?.intitule }}</td>
            <td class="font-bold text-right">{{ emprunt.montantEmprunt | currency:'FCFA':'symbol':'1.0-0' }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="emprunt.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentEmprunt(emprunt)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="emprunt.hasDocument" class="document-name text-sm text-primary">
                  {{ emprunt.fileName }}
                </span>
                <span *ngIf="!emprunt.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditEmprunt(emprunt)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="emprunt.editing">
            <td>
              <p-dropdown [options]="institutionFinanciere" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="emprunt.institutionFinanciere" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="emprunt.numeroCompte" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="typesEmprunt" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="emprunt.typeEmprunt" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="emprunt.montantEmprunt" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <div class="flex align-items-center">
<button *ngIf="showUploadForEmpruntId === emprunt.id"
        pButton icon="pi pi-upload" 
        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
        (click)="triggerFileUploadEmprunt(emprunt)" 
        pTooltip="{{emprunt.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
</button>


                
                <button *ngIf="emprunt.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentEmprunt(emprunt)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="emprunt.hasDocument" class="document-name text-sm text-primary">
                  {{ emprunt.fileName }}
                </span>
                <span *ngIf="!emprunt.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedEmprunt(emprunt)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditEmprunt(emprunt)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun emprunt trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{empruntsTemp ? empruntsTemp.length : 0}} emprunts
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUploadEmprunt id="fileUploadEmprunt" style="display:none" 
         (change)="onFileSelectEmprunt($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="emprunt-dialog"
  header="Ajouter un nouvel emprunt" 
  [(visible)]="displayAddDialogEmprunt"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouvel emprunt</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Institution et Type d'emprunt -->
      <div class="field col-12 md:col-6 p-3">
        <label for="institutionEmprunt" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-building mr-2 text-orange-500"></i>Institution<span class="text-danger">*</span>
        </label>
        <p-dropdown id="institutionEmprunt"
                  [options]="institutionFinanciere" 
                  optionLabel="intitule" 
                  [(ngModel)]="newEmprunt.institutionFinanciere" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newEmprunt.institutionFinanciere ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newEmprunt.institutionFinanciere">
              <i class="pi pi-building mr-2 text-orange-500"></i>
              <span>{{newEmprunt.institutionFinanciere.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-building mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newEmprunt.institutionFinanciere" class="p-error block mt-1">L'institution est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="typeEmprunt" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-list mr-2 text-orange-500"></i>Type d'emprunt<span class="text-danger">*</span>
        </label>
        <p-dropdown id="typeEmprunt"
                  [options]="typesEmprunt" 
                  optionLabel="intitule" 
                  [(ngModel)]="newEmprunt.typeEmprunt" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newEmprunt.typeEmprunt ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="newEmprunt.typeEmprunt">
              <i class="pi pi-list mr-2 text-orange-500"></i>
              <span>{{newEmprunt.typeEmprunt.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-list mr-2 text-orange-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !newEmprunt.typeEmprunt" class="p-error block mt-1">Le type d'emprunt est requis</small>
      </div>

      <!-- Ligne 2 - Numéro de compte et Montant -->
      <div class="field col-12 md:col-6 p-3">
        <label for="numeroCompteEmprunt" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-id-card mr-2 text-orange-500"></i>Numéro de compte<span class="text-danger">*</span>
        </label>
        <input id="numeroCompteEmprunt" 
               pInputText 
               [(ngModel)]="newEmprunt.numeroCompte" 
               class="w-full" 
               [style]="{'border-color': submitted && !newEmprunt.numeroCompte ? '#f87171' : '', 'height': '40px'}" />
        <small *ngIf="submitted && !newEmprunt.numeroCompte" class="p-error block mt-1">Le numéro de compte est requis</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="montantEmprunt" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Montant (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="montantEmprunt" pInputText [(ngModel)]="newEmprunt.montantEmprunt" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newEmprunt.montantEmprunt}" />
        </div>
        <small *ngIf="submitted && !newEmprunt.montantEmprunt" class="p-error block mt-1">Le montant est requis</small>
      </div>

      <!-- Ligne 3 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadDialogForNewEmprunt()" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="newEmprunt.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
            <i class="pi pi-file text-orange-500 mr-2"></i>
            <span class="text-sm text-orange-500">{{ newEmprunt.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileEmprunt()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddEmprunt()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddEmprunt()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="Espèce" class="line-height-3 m-0" (onOpen)="loadEspeces()" (onClose)="resetDeviseFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des espèces</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogEspece()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedEspeces.length"
                (click)="confirmDeleteSelectedespece()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="especeTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedEspeces"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['devise','montantFCFA']"
            #dtEspece>
           <ng-template pTemplate="caption">
  <div class="flex justify-content-between align-items-center">
    <div>
      <input pInputText type="number" [(ngModel)]="selectedDevise" 
             placeholder="Filtrer par ID devise" 
             (input)="filterByDevise()"
             class="w-full md:w-14rem p-inputtext-sm" />
    </div>
  </div>
</ng-template>


      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="devise">Devise <p-sortIcon field="devise"></p-sortIcon></th>
          <th pSortableColumn="monnaie">Montant <p-sortIcon field="monnaie"></p-sortIcon></th>
          <th pSortableColumn="tauxChange">Taux change <p-sortIcon field="tauxChange"></p-sortIcon></th>
          <th pSortableColumn="montantFCFA">Montant FCFA <p-sortIcon field="montantFCFA"></p-sortIcon></th>
          <th pSortableColumn="dateEspece">Date <p-sortIcon field="dateEspece"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>
<ng-template pTemplate="body" let-espece>
  <tr [class.editing-row]="espece.isEdit">
    <td><p-tableCheckbox [value]="espece"></p-tableCheckbox></td>
          
         <ng-container *ngIf="!espece.isEdit">
      <td>{{ espece.devise | number }}</td>
      <td>{{ espece.monnaie | number }}</td>
      <td>{{ espece.tauxChange | number }}</td>
      <td class="font-bold text-right">{{ espece.montantFCFA | currency:'FCFA':'symbol':'1.0-0' }}</td>
      <td>{{ espece.dateEspece | date:'dd/MM/yyyy' }}</td>
      
      <td>
        <div class="flex align-items-center">
          <button *ngIf="espece.isEdit"
                  pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                  (click)="triggerFileUploadEss(espece)"
                  pTooltip="{{espece.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
          </button>
          
          <button *ngIf="!espece.isEdit && espece.hasDocument" 
                  pButton icon="pi pi-download" 
                  class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                  (click)="downloadDocumentEspece(espece)"
                  pTooltip="Télécharger le document"></button>
          
          <span *ngIf="espece.hasDocument" class="document-name text-sm text-primary">
            {{ espece.fileName }}
          </span>
          <span *ngIf="!espece.hasDocument" class="text-gray-500 text-sm">
            {{ espece.isEdit ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
          </span>
        </div>
      </td>
      
      <td>
        <div class="flex gap-1 justify-content-center">
          <button pButton icon="pi pi-pencil" 
                  class="p-button-rounded p-button-text p-button-sm"
                  pTooltip="Modifier"
                  (click)="startEditEspece(espece)"></button>
        </div>
      </td>
    </ng-container>

    <ng-container *ngIf="espece.isEdit">
          <td>
  <input pInputText type="number" [(ngModel)]="espece.devise" class="w-full p-inputtext-sm" />
</td>
            <td><input pInputText [(ngModel)]="espece.monnaie" type="number" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="espece.tauxChange" type="number" class="w-full p-inputtext-sm" /></td>
            <td><input pInputText [(ngModel)]="espece.montantFCFA" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-calendar [(ngModel)]="espece.dateEspece" [appendTo]="'body'"
                        [showIcon]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td>
              <div class="flex align-items-center">
<button pButton icon="pi pi-upload" 
        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
        (click)="triggerFileUploadESS(espece)"
        pTooltip="Modifier le document">
</button>
                
                <button *ngIf="espece.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentEspece(espece)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="espece.hasDocument" class="document-name text-sm text-primary">
                  {{ espece.fileName }}
                </span>
                <span *ngIf="!espece.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedEspece(espece)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditEspece(espece)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucune espèce trouvée</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{especeTemp ? especeTemp.length : 0}} espèces
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #fileUploadEspece id="fileUploadEspece" style="display:none" 
         (change)="onFileSelectEspece($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<!-- Dialog for adding new currency -->
<p-dialog class="espece-dialog"
  header="Ajouter une nouvelle espèce" 
  [(visible)]="displayAddDialogEspece"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter une nouvelle espèce</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Devise et Montant -->
      <div class="field col-12 md:col-6 p-3">
        <label for="deviseEspece" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Devise<span class="text-danger">*</span>
        </label>
    <input id="deviseEspece" 
           pInputText 
           type="number" 
           [(ngModel)]="newEspece.devise" 
           placeholder="Entrez l'ID de la devise" 
           [required]="true" 
           class="w-full"
           [style]="{'border-color': submitted && !newEspece.devise ? '#f87171' : ''}"
           min="0"
           step="1">

        <small *ngIf="submitted && !newEspece.devise" class="p-error block mt-1">La devise est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="monnaieEspece" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-wallet mr-2 text-orange-500"></i>Montant<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <input id="monnaieEspece" pInputText [(ngModel)]="newEspece.monnaie" type="number" min="0" class="w-full" 
                 style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newEspece.monnaie}" />
        </div>
        <small *ngIf="submitted && !newEspece.monnaie" class="p-error block mt-1">Le montant est requis</small>
      </div>

      <!-- Ligne 2 - Taux de change et Montant FCFA -->
      <div class="field col-12 md:col-6 p-3">
        <label for="tauxChangeEspece" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-percentage mr-2 text-orange-500"></i>Taux de change<span class="text-danger">*</span>
        </label>
        <input id="tauxChangeEspece" pInputText [(ngModel)]="newEspece.tauxChange" type="number" min="0" class="w-full" 
               style="height: 40px;"
               [ngClass]="{'p-invalid': submitted && !newEspece.tauxChange}" />
        <small *ngIf="submitted && !newEspece.tauxChange" class="p-error block mt-1">Le taux de change est requis</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="montantFCFAEspece" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill-wave mr-2 text-orange-500"></i>Montant FCFA<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
          <input id="montantFCFAEspece" pInputText [(ngModel)]="newEspece.montantFCFA" type="number" min="0" class="w-full" 
                 style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !newEspece.montantFCFA}" />
        </div>
        <small *ngIf="submitted && !newEspece.montantFCFA" class="p-error block mt-1">Le montant FCFA est requis</small>
      </div>

      <!-- Ligne 3 - Date -->
      <div class="field col-12 md:col-6 p-3">
        <label for="dateEspece" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-orange-500"></i>Date<span class="text-danger">*</span>
        </label>
        <p-calendar id="dateEspece"
                  [(ngModel)]="newEspece.dateEspece" 
                  [appendTo]="'body'"
                  [showIcon]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !newEspece.dateEspece ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !newEspece.dateEspece" class="p-error block mt-1">La date est requise</small>
      </div>

      <!-- Ligne 4 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-orange-500"></i>Document justificatif
        </label>
       <div class="flex align-items-center gap-2">
  <button pButton icon="pi pi-upload" 
          class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
          (click)="showUploadDialogForNewEspece()" 
          label="Ajouter/Modifier document">
  </button>
  <div *ngIf="newEspece.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
    <i class="pi pi-file text-orange-500 mr-2"></i>
    <span class="text-sm text-orange-500">{{ newEspece.fileName }}</span>
    <button pButton icon="pi pi-times" 
            class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
            pTooltip="Supprimer"
            (click)="removeSelectedFileEspece($event)"></button>
  </div>
</div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddEspece()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
              (click)="confirmAddEspece()"></button>
    </div>
  </ng-template>
</p-dialog>
<p-accordionTab header="Titres et Valeurs" class="line-height-3 m-0" (onOpen)="loadTitresForDeclaration()" (onClose)="resetDesignationFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des titres</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogtitres()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedTitres.length"
                (click)="confirmDeleteSelectedTitres()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>
 <div class="mb-4">
      <p-dropdown [options]="naturesTitres" optionLabel="intitule" 
                 [(ngModel)]="selectedDesignation" [showClear]="true"
                 placeholder="Filtrer par nature de titre" (onChange)="filterByDesignationtitres()"
                 class="w-full md:w-20rem"></p-dropdown>
    </div>

    <p-table [value]="titresTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedTitres"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            #dt>
      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="designationNatureAction">Nature <p-sortIcon field="designationNatureAction"></p-sortIcon></th>
          <th pSortableColumn="valeurEmplacement">Valeur <p-sortIcon field="valeurEmplacement"></p-sortIcon></th>
          <th pSortableColumn="emplacement">Emplacement <p-sortIcon field="emplacement"></p-sortIcon></th>
          <th pSortableColumn="autrePrecision">Précisions <p-sortIcon field="autrePrecision"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-titre>
        <tr [class.editing-row]="titre.isEdit">
          <td><p-tableCheckbox [value]="titre"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!titre.isEdit">
            <td><span [class.font-medium]="true">{{ getIntitule(titre.designationNatureAction) }}</span></td>
            <td class="text-right">{{ titre.valeurEmplacement | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(titre.emplacement) }}</td>
            <td>{{ getIntitule(titre.autrePrecision) }}</td>
            
            <td>
              <div class="flex align-items-center">
   <button *ngIf="titre.isEdit"
        pButton icon="pi pi-upload" 
        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
        (click)="triggerFileUploadtitres(titre)"
        pTooltip="{{titre.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
</button>

                <button *ngIf="!titre.isEdit && titre.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumenttitres(titre)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="titre.hasDocument" class="document-name text-sm text-primary">
                  {{ titre.fileName }}
                </span>
                <span *ngIf="!titre.hasDocument" class="text-gray-500 text-sm">
                  {{ titre.isEdit ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditTitre(titre)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="titre.isEdit">
            <td>
              <p-dropdown [options]="naturesTitres" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="titre.designationNatureAction" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <input pInputText [(ngModel)]="titre.valeurEmplacement" type="number" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="emplacementsTitres" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="titre.emplacement" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="precisionsTitres" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="titre.autrePrecision" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            
            <td>
              <div class="flex align-items-center">
<button *ngIf="showUploadForTitreId === titre.id"
        pButton icon="pi pi-upload" 
        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
        (click)="triggerFileUploadtitres(titre)"
        pTooltip="Modifier le document">
</button>
                
                <button *ngIf="titre.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumenttitres(titre)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="titre.hasDocument" class="document-name text-sm text-primary">
                  {{ titre.fileName }}
                </span>
                <span *ngIf="!titre.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveTitre(titre)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditTitre(titre)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun titre trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{titresTemp ? titresTemp.length : 0}} titres
        </span>
      </ng-template>
    </p-table>
  </div>

 <input type="file" #fileUploadTitres id="fileUploadTitres" style="display:none" 
       (change)="onFileSelecttitres($event)" 
       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />

  <p-dialog  
    header="Ajouter un nouveau titre" 
    [(visible)]="displayUploadDialogtitres" 
    [modal]="true"
    [draggable]="false" 
    [resizable]="false"
    [style]="{
      width: '70vw', 
      maxWidth: '800px', 
      fontSize: '1.2rem', 
      borderRadius: '16px',
    }"
    styleClass="p-3 surface-ground text-color border-round-xl"
    [baseZIndex]="10000">
    
    <ng-template pTemplate="header">
      <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
        <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau titre</span>
      </div>
    </ng-template>

    <div class="p-dialog-content">
      <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
        <!-- Ligne 1 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="natureTitre" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-tags mr-2 text-orange-500"></i>Nature du titre<span class="text-danger">*</span>
          </label>
          <p-dropdown id="natureTitre"
                    [options]="naturesTitres" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowTitre.designationNatureAction" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowTitre.designationNatureAction ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowTitre.designationNatureAction">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{tableRowTitre.designationNatureAction.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowTitre.designationNatureAction" class="p-error block mt-1">La nature du titre est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="valeurEmplacement" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur de l'emplacement<span class="text-danger">*</span>
          </label>
          <div class="p-inputgroup" style="height: 40px;">
            <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
            <input id="valeurEmplacement" pInputText [(ngModel)]="tableRowTitre.valeurEmplacement" type="number" min="0" class="w-full" style="height: 40px;"
                   [ngClass]="{'p-invalid': submitted && !tableRowTitre.valeurEmplacement}" />
          </div>
          <small *ngIf="submitted && !tableRowTitre.valeurEmplacement" class="p-error block mt-1">La valeur est requise</small>
        </div>
        
        <!-- Ligne 2 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="emplacement" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-map-marker mr-2 text-orange-500"></i>Emplacement<span class="text-danger">*</span>
          </label>
          <p-dropdown id="emplacement"
                    [options]="emplacementsTitres" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowTitre.emplacement" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowTitre.emplacement ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowTitre.emplacement">
                <i class="pi pi-map-marker mr-2 text-orange-500"></i>
                <span>{{tableRowTitre.emplacement.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-map-marker mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowTitre.emplacement" class="p-error block mt-1">L'emplacement est requis</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="precision" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-info-circle mr-2 text-orange-500"></i>Précisions
          </label>
          <p-dropdown id="precision"
                    [options]="precisionsTitres" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowTitre.autrePrecision" 
                    placeholder="Sélectionner" 
                    class="w-full"
                    [style]="{'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowTitre.autrePrecision">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{tableRowTitre.autrePrecision.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
        
        <!-- Ligne 3 - Champ unique sur toute la largeur -->
        <div class="field col-12 p-3">
          <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
          </label>
          <div class="flex align-items-center gap-2">
            <button 
              pButton 
              icon="pi pi-upload" 
              class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
              (click)="showUploadDialogForNewTitre()" 
              label="Ajouter un document">
            </button>
            <div *ngIf="tableRowTitre.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
              <i class="pi pi-file text-orange-500 mr-2"></i>
              <span class="text-sm text-orange-500">{{ tableRowTitre.fileName }}</span>
              <button pButton icon="pi pi-times" 
                      class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                      pTooltip="Supprimer"
                      (click)="tableRowTitre.file = null; tableRowTitre.fileName = null; tableRowTitre.fileType = null;"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-center gap-3">
        <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddTitre()"></button>
        <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
                style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
                (click)="confirmAddTitre()"></button>
      </div>
    </ng-template>
  </p-dialog>
</p-accordionTab>
<p-accordionTab header="Revenu" (onOpen)="loadRevenusByDeclaration()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des revenus</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogRevenu()"
                title="Ajouter">
        </button>

        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedRevenus.length"
                (click)="handleDeleteActionRevenu()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>
<p-table [value]="revenusTemp" 
        [rows]="10" 
        [paginator]="true" 
        [rowHover]="true" 
        selectionMode="multiple" 
        [(selection)]="selectedRevenus"
        styleClass="p-datatable-sm p-datatable-gridlines" 
        [responsive]="true"
        [rowsPerPageOptions]="[5,10,25,50]"
        [globalFilterFields]="['autresRevenus.intitule','salaireMensuelNet']"
        #dtRevenu>
  <ng-template pTemplate="caption">
    <div class="flex justify-content-between align-items-center gap-3">
      <p-dropdown [options]="autresRevenus" 
                 optionLabel="intitule" 
                 placeholder="Filtrer par type de revenu" 
                 (onChange)="filterByRevenuType($event.value)"
                 [showClear]="true"
                 styleClass="w-full md:w-20rem">
        <ng-template pTemplate="selectedItem">
          <div *ngIf="selectedRevenuType" class="flex align-items-center">
            <span>{{selectedRevenuType.intitule}}</span>
          </div>
        </ng-template>
        <ng-template let-revenuType pTemplate="item">
          <div class="flex align-items-center">
            <span>{{revenuType.intitule}}</span>
          </div>
        </ng-template>
      </p-dropdown>
      
     
    </div>
  </ng-template>


      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="autresRevenus.intitule">Type de revenu <p-sortIcon field="autresRevenus.intitule"></p-sortIcon></th>
          <th pSortableColumn="salaireMensuelNet">Salaire net <p-sortIcon field="salaireMensuelNet"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-revenu>
        <tr [class.editing-row]="revenu.editing">
          <td><p-tableCheckbox [value]="revenu"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!revenu.editing">
            <td><span class="font-medium">{{ getIntitule(revenu.autresRevenus) }}</span></td>
            <td class="font-bold text-right">{{ revenu.salaireMensuelNet | currency:'FCFA':'symbol':'1.0-0' }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="revenu.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentRevenu(revenu)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="revenu.hasDocument" class="document-name text-sm text-primary">
                  {{ revenu.fileName }}
                </span>
                <span *ngIf="!revenu.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditRevenu(revenu)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="revenu.editing">
            <td>
              <p-dropdown [options]="autresRevenus" optionLabel="intitule" [appendTo]="'body'" 
                          [(ngModel)]="revenu.autresRevenus" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <input pInputText [(ngModel)]="revenu.salaireMensuelNet" type="number" class="w-full p-inputtext-sm" />
            </td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="showUploadForRevenuId === revenu.id"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="showUploadDialogRevenu(revenu)"
                        pTooltip="{{revenu.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="revenu.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentRevenu(revenu)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="revenu.hasDocument" class="document-name text-sm text-primary">
                  {{ revenu.fileName }}
                </span>
                <span *ngIf="!revenu.hasDocument" class="text-gray-500 text-sm">
                  {{ revenu.editing ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedRevenu(revenu)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditRevenu(revenu)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun revenu trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{revenusTemp ? revenusTemp.length : 0}} revenus
        </span>
      </ng-template>
    </p-table>
  </div>

  <input type="file" #fileUploadRevenu id="fileUploadRevenu" style="display:none" 
         (change)="onFileSelectRevenu($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />

  <!-- Dialog pour ajouter un nouveau revenu -->
  <p-dialog  
    header="Ajouter un nouveau revenu" 
    [(visible)]="displayAddDialogRevenu" 
    [modal]="true"
    [draggable]="false" 
    [resizable]="false"
    [style]="{
      width: '70vw', 
      maxWidth: '800px', 
      fontSize: '1.2rem', 
      borderRadius: '16px'
    }"
    styleClass="p-3 surface-ground text-color border-round-xl"
    [baseZIndex]="10000">
    
    <ng-template pTemplate="header">
      <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
        <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau revenu</span>
      </div>
    </ng-template>

    <div class="p-dialog-content">
      <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
        <!-- Ligne 1 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="typeRevenu" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-tags mr-2 text-orange-500"></i>Type de revenu<span class="text-danger">*</span>
          </label>
          <p-dropdown id="typeRevenu"
                    [options]="autresRevenus" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowRevenu.autresRevenus" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowRevenu.autresRevenus ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowRevenu.autresRevenus">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{tableRowRevenu.autresRevenus.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowRevenu.autresRevenus" class="p-error block mt-1">Le type de revenu est requis</small>
        </div>
        
    <div class="field col-12 md:col-6 p-3">
  <label for="salaire" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
    <i class="pi pi-money-bill mr-2 text-orange-500"></i>Salaire mensuel net (FCFA)<span class="text-danger">*</span>
  </label>
  <div class="p-inputgroup" style="height: 40px;">
    <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
    <input id="salaire" pInputText [(ngModel)]="tableRowRevenu.salaireMensuelNet" 
           type="number" min="1" class="w-full" style="height: 40px;"
           [ngClass]="{'p-invalid': submitted && (!tableRowRevenu.salaireMensuelNet || tableRowRevenu.salaireMensuelNet <= 0)}" />
  </div>
  <small *ngIf="submitted && (!tableRowRevenu.salaireMensuelNet || tableRowRevenu.salaireMensuelNet <= 0)" 
         class="p-error block mt-1">
    Le salaire doit être supérieur à 0
  </small>
</div>
        
        <!-- Ligne 2 - Champ unique sur toute la largeur -->
        <div class="field col-12 p-3">
          <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
          </label>
          <div class="flex align-items-center gap-2">
            <button pButton icon="pi pi-upload" 
                    class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                    (click)="showUploadDialogForNewRevenu()" 
                    label="Ajouter un document">
            </button>
            <div *ngIf="tableRowRevenu.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
              <i class="pi pi-file text-orange-500 mr-2"></i>
              <span class="text-sm text-orange-500">{{ tableRowRevenu.fileName }}</span>
              <button pButton icon="pi pi-times" 
                      class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                      pTooltip="Supprimer"
                      (click)="removeSelectedFileRevenu()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-center gap-3">
        <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddRevenu()"></button>
        <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
                style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
                (click)="confirmAddRevenu()"></button>
      </div>
    </ng-template>
  </p-dialog>
</p-accordionTab>
<p-accordionTab header="Créance" (onOpen)="loadCreancesByDeclaration()" (onClose)="resetCreanceFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des créances</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddCreanceFormDialog()"
                title="Ajouter">
        </button>

        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedCreances.length"
                (click)="confirmDeleteSelectedCreances()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="creancesTemp" 
             [rows]="10" 
             [paginator]="true" 
             [rowHover]="true" 
             selectionMode="multiple" 
             [(selection)]="selectedCreances"
             styleClass="p-datatable-sm p-datatable-gridlines" 
             [responsive]="true"
             [rowsPerPageOptions]="[5,10,25,50]"
             [globalFilterFields]="['debiteur','montant','autresPrecision']"
             #dtCreances>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="debiteursCreances" optionLabel="intitule" 
                        [(ngModel)]="selectedDebiteur" [showClear]="true"
                        placeholder="Filtrer par débiteur" (onChange)="filterByDebiteur()"
                        class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="debiteur">Débiteur <p-sortIcon field="debiteur"></p-sortIcon></th>
          <th pSortableColumn="montant">Montant (FCFA) <p-sortIcon field="montant"></p-sortIcon></th>
          <th pSortableColumn="autresPrecision">Précisions <p-sortIcon field="autresPrecision"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-creance>
        <tr [class.editing-row]="creance.editing">
          <td><p-tableCheckbox [value]="creance"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!creance.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(creance.debiteur) }}</span></td>
            <td class="font-bold text-right">{{ creance.montant | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(creance.autresPrecision) }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="creance.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadCreanceDocument(creance)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="creance.hasDocument" class="document-name text-sm text-primary">
                  {{ creance.fileName }}
                </span>
                <span *ngIf="!creance.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditCreance(creance)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="creance.editing">
            <td>
              <p-dropdown [options]="debiteursCreances" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="creance.debiteur" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <input pInputText [(ngModel)]="creance.montant" type="number" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="autresPrecisionsCreances" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="creance.autresPrecision" class="w-full p-inputtext-sm"></p-dropdown>
            </td>

            <td>
              <div class="flex align-items-center">
                <button 
                  pButton 
                  icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="showUploadCreanceDialog(creance)" 
                  pTooltip="{{creance.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="creance.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadCreanceDocument(creance)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="creance.hasDocument" class="document-name text-sm text-primary">
                  {{ creance.fileName }}
                </span>
                <span *ngIf="!creance.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedCreance(creance)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditCreance(creance)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucune créance trouvée</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{creancesTemp ? creancesTemp.length : 0}} créances
        </span>
      </ng-template>
    </p-table>
  </div>
  <input type="file" #fileUploadCreance id="fileUploadCreance" style="display:none" 
         (change)="onCreanceFileSelect($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>
<p-dialog header="Ajouter une nouvelle créance"
          [(visible)]="displayAddCreanceDialog"
          [modal]="true"
          [draggable]="false"
          [resizable]="false"
          [style]="{ width: '70vw', maxWidth: '800px', fontSize: '1.2rem', borderRadius: '16px' }"
          styleClass="p-3 surface-ground text-color border-round-xl"
          [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter une nouvelle créance</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">

      <!-- Débiteur -->
      <div class="field col-12 md:col-6 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-user mr-2 text-orange-500"></i>Débiteur<span class="text-danger">*</span>
        </label>
        <p-dropdown [options]="debiteursCreances" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowCreance.debiteur" 
                    placeholder="Sélectionner"
                    [required]="true"
                    class="w-full"
                    [style]="{ 'border-color': creanceSubmitted && !tableRowCreance.debiteur ? '#f87171' : '', 'height': '40px' }">
        </p-dropdown>
        <small *ngIf="creanceSubmitted && !tableRowCreance.debiteur" class="p-error block mt-1">Le débiteur est requis</small>
      </div>

      <!-- Montant -->
      <div class="field col-12 md:col-6 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-orange-500"></i>Montant (FCFA)<span class="text-danger">*</span>
        </label>
        <input pInputText [(ngModel)]="tableRowCreance.montant" type="number" class="w-full" placeholder="Ex: 150000" />
        <small *ngIf="creanceSubmitted && !tableRowCreance.montant" class="p-error block mt-1">Le montant est requis</small>
      </div>

      <!-- Autres Précisions -->
      <div class="field col-12 md:col-6 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-info-circle mr-2 text-orange-500"></i>Autres Précisions
        </label>
        <p-dropdown [options]="autresPrecisionsCreances" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowCreance.autresPrecision"
                    placeholder="Sélectionner" 
                    class="w-full">
        </p-dropdown>
      </div>

    
<div class="field col-12 p-3">
  <label class="font-bold mb-2 block">Document justificatif</label>
  <div class="flex align-items-center gap-2">
    <button pButton type="button" 
            icon="pi pi-upload"
            label="Choisir un fichier"
            class="p-button-sm p-button-outlined"
            (click)="fileUploadCreanceInput.click()"></button>
    <span *ngIf="tableRowCreance.file" class="text-sm text-primary">
      {{ tableRowCreance.file.name }}
    </span>
    <span *ngIf="!tableRowCreance?.file && tableRowCreance?.fileName" class="text-sm text-primary">
      {{ tableRowCreance.fileName }}
    </span>
    <span *ngIf="!tableRowCreance?.file && !tableRowCreance?.fileName" class="text-sm text-gray-500">
      Aucun fichier sélectionné
    </span>
  </div>
  <small class="text-gray-500 block mt-1">Formats acceptés: PDF, DOC, DOCX, JPG, JPEG, PNG (max 5MB)</small>
</div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-end gap-2">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-text" (click)="hideAddCreanceDialog()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button" (click)="addCreance()"></button>
    </div>
  </ng-template>
</p-dialog>

<!-- input hidden pour le fichier -->
<input type="file" #fileUploadCreanceInput id="fileUploadCreanceInput" style="display:none"
       (change)="onCreanceFileSelect($event)"
       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
<p-accordionTab header="Véhicules" (onOpen)="loadVehiculesByDeclaration()" >
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des véhicules</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogvv()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedVehicules.length"
                (click)="confirmDeleteSelectedvv()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="vehiculesTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedVehicules"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['designation','marque','immatriculation']"
            #dt>
            
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="marquesVehicule" optionLabel="intitule" 
                        [(ngModel)]="selectedMarque" [showClear]="true"
                        placeholder="Filtrer par marque" (onChange)="filterByMarque()"
                        class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="designation">Désignation <p-sortIcon field="designation"></p-sortIcon></th>
          <th pSortableColumn="marque">Marque <p-sortIcon field="marque"></p-sortIcon></th>
          <th pSortableColumn="immatriculation">Immatriculation <p-sortIcon field="immatriculation"></p-sortIcon></th>
          <th pSortableColumn="anneeAcquisition">Année acq. <p-sortIcon field="anneeAcquisition"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisition">Valeur acq. <p-sortIcon field="valeurAcquisition"></p-sortIcon></th>
          <th pSortableColumn="etatGeneral">État <p-sortIcon field="etatGeneral"></p-sortIcon></th>
          <th pSortableColumn="kilometrage">Kilométrage <p-sortIcon field="kilometrage"></p-sortIcon></th>
          <th pSortableColumn="carburant">Carburant <p-sortIcon field="carburant"></p-sortIcon></th>
          <th pSortableColumn="transmission">Transmission <p-sortIcon field="transmission"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-vehicule>
        <tr [class.editing-row]="vehicule.editing">
          <td><p-tableCheckbox [value]="vehicule"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!vehicule.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(vehicule.designation) }}</span></td>
            <td>{{ getIntitule(vehicule.marque) }}</td>
            <td>{{ vehicule.immatriculation }}</td>
            <td>{{ vehicule.anneeAcquisition | date:'yyyy' }}</td>
            <td class="font-bold text-right">{{ vehicule.valeurAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(vehicule.etatGeneral) }}</td>
            <td>{{ vehicule.kilometrage | number }} km</td>
            <td>{{ getIntitule(vehicule.carburant) }}</td>
            <td>{{ getIntitule(vehicule.transmission) }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="!vehicule.editing && vehicule.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentvv(vehicule)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="vehicule.hasDocument" class="document-name text-sm text-primary">
                  {{ vehicule.fileName }}
                </span>
                <span *ngIf="!vehicule.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditVehicule(vehicule)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="vehicule.editing">
            <td>
              <p-dropdown [options]="designationsVehicule" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="vehicule.designation" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="marquesVehicule" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="vehicule.marque" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="vehicule.immatriculation" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-calendar [(ngModel)]="vehicule.anneeAcquisition" [appendTo]="'body'" 
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td><input pInputText [(ngModel)]="vehicule.valeurAcquisition" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="etatsVehicule" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="vehicule.etatGeneral" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td><input pInputText [(ngModel)]="vehicule.kilometrage" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
<p-dropdown [options]="carburant" optionLabel="intitule" [(ngModel)]="vehicule.carburant" class="w-full p-inputtext-sm"></p-dropdown>

            </td>
            <td>
              <p-dropdown [options]="typesTransmission" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="vehicule.transmission" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="flex align-items-center">
                <button 
                *ngIf="showUploadForVehiculeId === vehicule.id"
                pButton 
                icon="pi pi-upload" 
                class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                (click)="showUploadDialogvv(vehicule)" 
                pTooltip="Modifier le document">
              </button>
                
                <button *ngIf="vehicule.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentvv(vehicule)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="vehicule.hasDocument" class="document-name text-sm text-primary">
                  {{ vehicule.fileName }}
                </span>
                <span *ngIf="!vehicule.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
  
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedVehicule(vehicule)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditVehicule(vehicule)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="12">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-car text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun véhicule trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{vehiculesTemp ? vehiculesTemp.length : 0}} véhicules
        </span>
      </ng-template>
    </p-table>
  </div>
<!-- Remplacer #fileUpload par #filevehiculeUpload -->
<input type="file" #filevehiculeUpload id="fileUpload" style="display:none" 
       (change)="onFileSelectvv($event)" 
       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<!-- Dialog pour ajouter un nouveau véhicule -->
<p-dialog  
    header="Ajouter un nouveau véhicule" 
    [(visible)]="displayAddDialog" 
    [modal]="true"
    [draggable]="false" 
    [resizable]="false"
    [style]="{
      width: '70vw', 
      maxWidth: '800px', 
      fontSize: '1.2rem', 
      borderRadius: '16px',
    }"
    styleClass="p-3 surface-ground text-color border-round-xl"
    [baseZIndex]="10000">

    <ng-template pTemplate="header">
      <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
        <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau véhicule</span>
      </div>
    </ng-template>

    <div class="p-dialog-content">
      <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
        <!-- Ligne 1 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="designation" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-tags mr-2 text-orange-500"></i>Désignation<span class="text-danger">*</span>
          </label>
          <p-dropdown id="designation"
                    [options]="designationsVehicule" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowVehicule.designation" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowVehicule.designation ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowVehicule.designation">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{tableRowVehicule.designation.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowVehicule.designation" class="p-error block mt-1">La désignation est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="marque" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-bookmark mr-2 text-orange-500"></i>Marque<span class="text-danger">*</span>
          </label>
          <p-dropdown id="marque"
                    [options]="marquesVehicule" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowVehicule.marque" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowVehicule.marque ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowVehicule.marque">
                <i class="pi pi-bookmark mr-2 text-orange-500"></i>
                <span>{{tableRowVehicule.marque.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-bookmark mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowVehicule.marque" class="p-error block mt-1">La marque est requise</small>
        </div>
        
        <!-- Ligne 2 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="immatriculation" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-id-card mr-2 text-orange-500"></i>Immatriculation<span class="text-danger">*</span>
          </label>
          <input id="immatriculation" pInputText [(ngModel)]="tableRowVehicule.immatriculation" class="w-full" 
                 style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !tableRowVehicule.immatriculation}" />
          <small *ngIf="submitted && !tableRowVehicule.immatriculation" class="p-error block mt-1">L'immatriculation est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="annee" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-calendar mr-2 text-orange-500"></i>Année d'acquisition<span class="text-danger">*</span>
          </label>
          <p-calendar id="annee"
                    [(ngModel)]="tableRowVehicule.anneeAcquisition" 
                    view="year" 
                    dateFormat="yy" 
                    [yearNavigator]="true" 
                    [required]="true"
                    placeholder="Année"
                    [yearRange]="'1900:2025'"
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowVehicule.anneeAcquisition ? '#f87171' : '', 'height': '40px'}"></p-calendar>
          <small *ngIf="submitted && !tableRowVehicule.anneeAcquisition" class="p-error block mt-1">L'année d'acquisition est requise</small>
        </div>
        
        <!-- Ligne 3 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="valeur" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
          </label>
          <div class="p-inputgroup" style="height: 40px;">
            <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
            <input id="valeur" pInputText [(ngModel)]="tableRowVehicule.valeurAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                   [ngClass]="{'p-invalid': submitted && !tableRowVehicule.valeurAcquisition}" />
          </div>
          <small *ngIf="submitted && !tableRowVehicule.valeurAcquisition" class="p-error block mt-1">La valeur d'acquisition est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="etat" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-chart-bar mr-2 text-orange-500"></i>État général<span class="text-danger">*</span>
          </label>
          <p-dropdown id="etat"
                    [options]="etatsVehicule" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowVehicule.etatGeneral" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowVehicule.etatGeneral ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowVehicule.etatGeneral">
                <i class="pi pi-chart-bar mr-2 text-orange-500"></i>
                <span>{{tableRowVehicule.etatGeneral.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-chart-bar mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowVehicule.etatGeneral" class="p-error block mt-1">L'état général est requis</small>
        </div>
        
        <!-- Ligne 4 - Nouveaux champs -->
        <div class="field col-12 md:col-6 p-3">
          <label for="kilometrage" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-dashboard mr-2 text-orange-500"></i>Kilométrage
          </label>
          <div class="p-inputgroup" style="height: 40px;">
            <input id="kilometrage" pInputText [(ngModel)]="tableRowVehicule.kilometrage" type="number" min="0" class="w-full" style="height: 40px;" />
            <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">km</span>
          </div>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="carburant" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-filter mr-2 text-orange-500"></i>Type de carburant
          </label>
<p-dropdown id="carburant"
      [options]="carburant"  
      optionLabel="intitule" 
      [(ngModel)]="tableRowVehicule.carburant" 
      placeholder="Sélectionner" 
      [required]="true"
      class="w-full"
      [style]="{'border-color': submitted && !tableRowVehicule.carburant ? '#f87171' : '', 'height': '40px'}">
    <ng-template pTemplate="selectedItem">
      <div class="flex align-items-center" *ngIf="tableRowVehicule.carburant">
        <i class="pi pi-filter mr-2 text-orange-500"></i>
        <span>{{tableRowVehicule.carburant.intitule}}</span>
      </div>
    </ng-template>
    <ng-template let-item pTemplate="item">
      <div class="flex align-items-center">
        <i class="pi pi-filter mr-2 text-orange-500"></i>
        <span>{{item.intitule}}</span>
      </div>
    </ng-template>
</p-dropdown>
<small *ngIf="submitted && !tableRowVehicule.carburant" class="p-error block mt-1">Le type de carburant est requis</small>
        </div>
        
        <!-- Ligne 5 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="transmission" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-cog mr-2 text-orange-500"></i>Type de transmission
          </label>
          <p-dropdown id="transmission"
                    [options]="typesTransmission" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowVehicule.transmission" 
                    placeholder="Sélectionner" 
                    class="w-full"
                    [style]="{'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowVehicule.transmission">
                <i class="pi pi-cog mr-2 text-orange-500"></i>
                <span>{{tableRowVehicule.transmission.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-cog mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
        
        <!-- Ligne 6 - Document -->
        <div class="field col-12 p-3">
          <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
          </label>
          <div class="flex align-items-center gap-2">
            <button 
              pButton 
              icon="pi pi-upload" 
              class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
              (click)="showUploadDialogForNewVehicule()" 
              label="Ajouter un document" >
            </button>
            <div *ngIf="tableRowVehicule.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
              <i class="pi pi-file text-orange-500 mr-2"></i>
              <span class="text-sm text-orange-500">{{ tableRowVehicule.fileName }}</span>
              <button pButton icon="pi pi-times" 
                      class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                      pTooltip="Supprimer"
                      (click)="removeSelectedFilevv()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-center gap-3">
        <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddVehicule()"></button>
        <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
                style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
                (click)="confirmAddVehicule()"></button>
      </div>
    </ng-template>
</p-dialog>

<!-- Dialog pour télécharger un document -->
<p-dialog header="Télécharger un document" 
         [(visible)]="displayUploadDialog" 
         [style]="{width: '450px'}" 
         [modal]="true" 
         [draggable]="false" 
         [resizable]="false"
         styleClass="custom-dialog">
  <ng-template pTemplate="header">
    <div class="w-full text-center" style="background: linear-gradient(to right, #ff7b00, #ff9e00);">
      <span class="text-white text-xl font-bold">Télécharger un document</span>
    </div>
  </ng-template>
  
  <div class="p-dialog-content">
    <div class="flex flex-column p-4 surface-card border-round-lg shadow-2">
      <label class="font-bold mb-2 text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
        <i class="pi pi-file-import mr-2 text-orange-500"></i>Sélectionner un fichier
      </label>
      <div class="p-field-file">
        <div class="py-3 px-4 border-1 border-dashed border-orange-500 border-round mb-2 text-center cursor-pointer hover:bg-orange-50 transition-colors transition-duration-300" 
             (click)="fileInput.click()" 
             (dragover)="$event.preventDefault()" 
             (drop)="handleFileDropvv($event)">
          <span class="flex flex-column align-items-center">
            <i class="pi pi-cloud-upload text-5xl text-orange-500 mb-2"></i>
            <span class="text-orange-500">Glisser et déposer un fichier ici ou cliquer pour parcourir</span>
            <span class="text-sm text-orange-300 mt-1">
              (.pdf, .doc, .docx, .jpg, .jpeg, .png) - max 5 MB
            </span>
          </span>
        </div>
        <input #fileInput type="file" (change)="onFileSelectvv($event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
               style="display:none;" />
      </div>
      <div *ngIf="selectedFile" class="mt-3 flex align-items-center bg-orange-50 p-2 border-round">
        <i class="pi pi-file text-orange-500 mr-2"></i>
        <span class="text-orange-500">{{ selectedFile.name }}</span>
        <span class="text-sm text-orange-300 ml-2">({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)</span>
      </div>
    </div>
  </div>
  
 <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelUploadvv()"></button>
      <button pButton label="Télécharger" icon="pi pi-upload" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;"
              [disabled]="!selectedFile"
              (click)="uploadFile()"></button>
    </div>
  </ng-template>
</p-dialog>
 <p-accordionTab header="Autre bien de valeur" (onOpen)="loadAutresBiensByDeclaration()" (onClose)="resetNatureFilter()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des autres biens</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogAutreBien()"
                title="Ajouter">
        </button>
        
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedAutresBiens.length"
                (click)="confirmDeleteSelectedAutresBiens()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="autresBiensTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedAutresBiens"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['type','designation','localite']"
            #dt>
            <ng-template pTemplate="caption">
              <div class="flex justify-content-between align-items-center">
                <div>
                  <p-dropdown [options]="typesBien" optionLabel="intitule" 
                              [(ngModel)]="selectedType" [showClear]="true"
                              placeholder="Filtrer par type" (onChange)="filterByType()"
                              class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
                </div>
              </div>
            </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="type">Type <p-sortIcon field="type"></p-sortIcon></th>
          <th pSortableColumn="designation">Désignation <p-sortIcon field="designation"></p-sortIcon></th>
          <th pSortableColumn="localite">Localité <p-sortIcon field="localite"></p-sortIcon></th>
          <th pSortableColumn="anneeAcquis">Année d'acquisition <p-sortIcon field="anneeAcquis"></p-sortIcon></th>
          <th pSortableColumn="valeurAcquisition">Valeur d'acquisition <p-sortIcon field="valeurAcquisition"></p-sortIcon></th>
          <th pSortableColumn="autresPrecision">Autres précisions <p-sortIcon field="autresPrecision"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-bien>
        <tr [class.editing-row]="bien.editing">
          <td><p-tableCheckbox [value]="bien"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!bien.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(bien.type) }}</span></td>
            <td>{{ getIntitule(bien.designation) }}</td>
            <td>{{ getIntitule(bien.localite) }}</td>
            <td>{{ bien.anneeAcquis | date:'yyyy' }}</td>
            <td class="font-bold text-right">{{ bien.valeurAcquisition | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(bien.autresPrecision) }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="bien.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocument(bien)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="bien.hasDocument" class="document-name text-sm text-primary">
                  {{ bien.fileName }}
                </span>
                <span *ngIf="!bien.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditAutreBien(bien)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="bien.editing">
            <td>
              <p-dropdown [options]="typesBien" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="bien.type" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="designation" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="bien.designation" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="localites" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="bien.localite" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-calendar [(ngModel)]="bien.anneeAcquis" [appendTo]="'body'" 
                        view="year" dateFormat="yy" [yearNavigator]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td><input pInputText [(ngModel)]="bien.valeurAcquisition" type="number" class="w-full p-inputtext-sm" /></td>
            <td>
              <p-dropdown [options]="autresPrecision" [appendTo]="'body'" optionLabel="intitule" 
                        [(ngModel)]="bien.autresPrecision" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="flex align-items-center">
                <button 
                pButton 
                icon="pi pi-upload" 
                class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                (click)="showUploadDialog(bien)" 
                pTooltip="{{bien.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
              </button>
                
                <button *ngIf="bien.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocument(bien)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="bien.hasDocument" class="document-name text-sm text-primary">
                  {{ bien.fileName }}
                </span>
                <span *ngIf="!bien.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
  
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedAutreBien(bien)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditAutreBien(bien)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucun autre bien trouvé</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{autresBiensTemp ? autresBiensTemp.length : 0}} biens
        </span>
      </ng-template>
    </p-table>
  </div>
  <input type="file" #fileUploadAutreBien id="fileUpload" style="display:none" 
          (change)="onFileSelect($event)" 
          accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog  
    header="Ajouter un nouveau bien de valeur" 
    [(visible)]="displayAddDialogAutreBien" 
    [modal]="true"
    [draggable]="false" 
    [resizable]="false"
    [style]="{
      width: '70vw', 
      maxWidth: '800px', 
      fontSize: '1.2rem', 
      borderRadius: '16px'
    }"
    styleClass="p-3 surface-ground text-color border-round-xl"
    [baseZIndex]="10000">
    
    <ng-template pTemplate="header">
      <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
        <span class="text-black text-xl font-bold tracking-wide">Ajouter un nouveau bien de valeur</span>
      </div>
    </ng-template>

    <div class="p-dialog-content">
      <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
        <div class="field col-12 md:col-6 p-3">
          <label for="type" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-tags mr-2 text-orange-500"></i>Type<span class="text-danger">*</span>
          </label>
          <p-dropdown id="type"
                    [options]="typesBien" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreBien.type" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreBien.type ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreBien.type">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{tableRowAutreBien.type.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-tag mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowAutreBien.type" class="p-error block mt-1">Le type est requis</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="designation" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-list mr-2 text-orange-500"></i>Désignation<span class="text-danger">*</span>
          </label>
          <p-dropdown id="designation"
                    [options]="designation" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreBien.designation" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreBien.designation ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreBien.designation">
                <i class="pi pi-list mr-2 text-orange-500"></i>
                <span>{{tableRowAutreBien.designation.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-list mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowAutreBien.designation" class="p-error block mt-1">La désignation est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="localite" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-map-marker mr-2 text-orange-500"></i>Localité<span class="text-danger">*</span>
          </label>
          <p-dropdown id="localite"
                    [options]="localites" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreBien.localite" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreBien.localite ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreBien.localite">
                <i class="pi pi-map-marker mr-2 text-orange-500"></i>
                <span>{{tableRowAutreBien.localite.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-map-marker mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowAutreBien.localite" class="p-error block mt-1">La localité est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="annee" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-calendar mr-2 text-orange-500"></i>Année d'acquisition<span class="text-danger">*</span>
          </label>
          <p-calendar id="annee"
                    [(ngModel)]="tableRowAutreBien.anneeAcquis" 
                    view="year" 
                    dateFormat="yy" 
                    [yearNavigator]="true" 
                    [required]="true"
                    placeholder="Année"
                    [yearRange]="'1900:2025'"
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreBien.anneeAcquis ? '#f87171' : '', 'height': '40px'}"></p-calendar>
          <small *ngIf="submitted && !tableRowAutreBien.anneeAcquis" class="p-error block mt-1">L'année est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="valeur" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-money-bill mr-2 text-orange-500"></i>Valeur d'acquisition (FCFA)<span class="text-danger">*</span>
          </label>
          <div class="p-inputgroup" style="height: 40px;">
            <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
            <input id="valeur" pInputText [(ngModel)]="tableRowAutreBien.valeurAcquisition" type="number" min="0" class="w-full" style="height: 40px;"
                   [ngClass]="{'p-invalid': submitted && !tableRowAutreBien.valeurAcquisition}" />
          </div>
          <small *ngIf="submitted && !tableRowAutreBien.valeurAcquisition" class="p-error block mt-1">La valeur d'acquisition est requise</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="precisions" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-info-circle mr-2 text-orange-500"></i>Autres précisions
          </label>
          <p-dropdown id="precisions"
                    [options]="autresPrecision" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreBien.autresPrecision" 
                    placeholder="Sélectionner" 
                    class="w-full"
                    [style]="{'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreBien.autresPrecision">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{tableRowAutreBien.autresPrecision.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
        
        <div class="field col-12 p-3">
          <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
          </label>
          <div class="flex align-items-center gap-2">
            <button 
              pButton 
              icon="pi pi-upload" 
              class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
              (click)="showUploadDialogForNewAutreBien()" 
              label="Ajouter un document">
            </button>
            <div *ngIf="tableRowAutreBien.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
              <i class="pi pi-file text-orange-500 mr-2"></i>
              <span class="text-sm text-orange-500">{{ tableRowAutreBien.fileName }}</span>
              <button pButton icon="pi pi-times" 
                      class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                      pTooltip="Supprimer"
                      (click)="removeSelectedFile()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-center gap-3">
        <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddAutreBien()"></button>
        <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
                style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
                (click)="confirmAddAutreBien()"></button>
      </div>
    </ng-template>
</p-dialog>

<p-dialog header="Télécharger un document" 
        [(visible)]="displayUploadDialog" 
        [style]="{width: '450px'}" 
        [modal]="true" 
        [draggable]="false" 
        [resizable]="false"
        styleClass="custom-dialog">
  <ng-template pTemplate="header">
    <div class="w-full text-center" style="background: linear-gradient(to right, #ff7b00, #ff9e00);">
      <span class="text-white text-xl font-bold">Télécharger un document</span>
    </div>
  </ng-template>
  
  <div class="p-dialog-content">
    <div class="flex flex-column p-4 surface-card border-round-lg shadow-2">
      <label class="font-bold mb-2 text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
        <i class="pi pi-file-import mr-2 text-orange-500"></i>Sélectionner un fichier
      </label>
      <div class="p-field-file">
        <div class="py-3 px-4 border-1 border-dashed border-orange-500 border-round mb-2 text-center cursor-pointer hover:bg-orange-50 transition-colors transition-duration-300" 
            (click)="fileInput.click()" 
            (dragover)="$event.preventDefault()" 
            (drop)="handleFileDrop($event)">
          <span class="flex flex-column align-items-center">
            <i class="pi pi-cloud-upload text-5xl text-orange-500 mb-2"></i>
            <span class="text-orange-500">Glisser et déposer un fichier ici ou cliquer pour parcourir</span>
            <span class="text-sm text-orange-300 mt-1">
              (.pdf, .doc, .docx, .jpg, .jpeg, .png) - max 5 MB
            </span>
          </span>
        </div>
        <input #fileInput type="file" (change)="onFileSelect($event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              style="display:none;" />
      </div>
      <div *ngIf="selectedFile" class="mt-3 flex align-items-center bg-orange-50 p-2 border-round">
        <i class="pi pi-file text-orange-500 mr-2"></i>
        <span class="text-orange-500">{{ selectedFile.name }}</span>
        <span class="text-sm text-orange-300 ml-2">({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)</span>
      </div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelUploaddette()"></button>
      <button pButton label="Télécharger" icon="pi pi-upload" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;"
              [disabled]="!selectedFile"
              (click)="uploadFiledette()"></button>
    </div>
  </ng-template>
</p-dialog>

<p-confirmDialog
  [style]="{ width: '450px', border: '1px solid #e2e8f0' }"
  header="Confirmation"
  icon="pi pi-question-circle"
  [baseZIndex]="10000"
  [styleClass]="'centered-dialog'"
  rejectButtonStyleClass="p-button-danger order-first"
  acceptButtonStyleClass="p-button-success order-last"
></p-confirmDialog> 



 <p-accordionTab header="Autre Dette" class="line-height-3 m-0" (onOpen)="loadAutresDettes()">
  <div class="card mb-4 p-3 shadow-sm">
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des dettes</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogdette()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedAutresDettes.length"
                (click)="confirmDeleteSelecteddette()"
                title="Supprimer sélection">
        </button>
      </div>
    </div>

    <p-table [value]="autresDettesTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedAutresDettes"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            #dt>
      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="creancier">Créancier <p-sortIcon field="creancier"></p-sortIcon></th>
          <th pSortableColumn="montant">Montant <p-sortIcon field="montant"></p-sortIcon></th>
          <th pSortableColumn="pathJustificatif">Justificatif <p-sortIcon field="pathJustificatif"></p-sortIcon></th>
          <th>Précisions</th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-dette>
        <tr [class.editing-row]="dette.isEdit">
          <td><p-tableCheckbox [value]="dette"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!dette.isEdit">
            <td><span [class.font-medium]="true">{{ getIntitule(dette.creancier) }}</span></td>
            <td class="font-bold text-right">{{ dette.montant | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ getIntitule(dette.pathJustificatif) }}</td>
            <td>{{ getIntitule(dette.autresPrecisions) }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="dette.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocument(dette)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="dette.hasDocument" class="document-name text-sm text-primary">
                  {{ dette.fileName }}
                </span>
                <span *ngIf="!dette.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditDette(dette)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="dette.isEdit">
            <td>
              <p-dropdown [options]="creanciers" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="dette.creancier" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="p-inputgroup">
                <span class="p-inputgroup-addon">FCFA</span>
                <input pInputText [(ngModel)]="dette.montant" type="number" class="w-full p-inputtext-sm" />
              </div>
            </td>
            <td>
              <p-dropdown [options]="justificatifs" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="dette.pathJustificatif" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <p-dropdown [options]="autresPrecisions" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="dette.autresPrecisions" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            
            <td>
              <div class="flex align-items-center">
                <button pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="triggerFileUpload(dette)"
                        pTooltip="Ajouter/modifier document"></button>
                
                <span *ngIf="dette.hasDocument" class="document-name text-sm text-primary">
                  {{ dette.fileName }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedDette(dette)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditDette(dette)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-folder-open text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucune dette trouvée</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{autresDettesTemp ? autresDettesTemp.length : 0}} dettes
        </span>
      </ng-template>
    </p-table>
  </div>

  <!-- Dialog pour ajouter une nouvelle dette -->
  <p-dialog  
    header="Ajouter une nouvelle dette" 
    [(visible)]="displayAddDialog" 
    [modal]="true"
    [draggable]="false" 
    [resizable]="false"
    [style]="{
      width: '70vw', 
      maxWidth: '800px', 
      fontSize: '1.2rem', 
      borderRadius: '16px'
    }"
    styleClass="p-3 surface-ground text-color border-round-xl"
    [baseZIndex]="10000">
    
    <ng-template pTemplate="header">
      <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
        <span class="text-black text-xl font-bold tracking-wide">Ajouter une nouvelle dette</span>
      </div>
    </ng-template>

    <div class="p-dialog-content">
      <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
        <!-- Ligne 1 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="creancier" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-building mr-2 text-orange-500"></i>Créancier<span class="text-danger">*</span>
          </label>
          <p-dropdown id="creancier"
                    [options]="creanciers" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreDette.creancier" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreDette.creancier ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreDette.creancier">
                <i class="pi pi-building mr-2 text-orange-500"></i>
                <span>{{tableRowAutreDette.creancier.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-building mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowAutreDette.creancier" class="p-error block mt-1">Le créancier est requis</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="montant" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-money-bill mr-2 text-orange-500"></i>Montant (FCFA)<span class="text-danger">*</span>
          </label>
          <div class="p-inputgroup" style="height: 40px;">
            <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #ff7b00, #ff9e00); color: white;">FCFA</span>
            <input id="montant" pInputText [(ngModel)]="tableRowAutreDette.montant" type="number" min="0" class="w-full" style="height: 40px;"
                   [ngClass]="{'p-invalid': submitted && !tableRowAutreDette.montant}" />
          </div>
          <small *ngIf="submitted && !tableRowAutreDette.montant" class="p-error block mt-1">Le montant est requis</small>
        </div>
        
        <!-- Ligne 2 -->
        <div class="field col-12 md:col-6 p-3">
          <label for="justificatif" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Justificatif<span class="text-danger">*</span>
          </label>
          <p-dropdown id="justificatif"
                    [options]="justificatifs" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreDette.pathJustificatif" 
                    placeholder="Sélectionner" 
                    [required]="true" 
                    class="w-full"
                    [style]="{'border-color': submitted && !tableRowAutreDette.pathJustificatif ? '#f87171' : '', 'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreDette.pathJustificatif">
                <i class="pi pi-file mr-2 text-orange-500"></i>
                <span>{{tableRowAutreDette.pathJustificatif.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-file mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
          <small *ngIf="submitted && !tableRowAutreDette.pathJustificatif" class="p-error block mt-1">Le justificatif est requis</small>
        </div>
        
        <div class="field col-12 md:col-6 p-3">
          <label for="precisions" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-info-circle mr-2 text-orange-500"></i>Précisions
          </label>
          <p-dropdown id="precisions"
                    [options]="autrePrecisions" 
                    optionLabel="intitule" 
                    [(ngModel)]="tableRowAutreDette.autresPrecisions" 
                    placeholder="Sélectionner" 
                    class="w-full"
                    [style]="{'height': '40px'}">
            <ng-template pTemplate="selectedItem">
              <div class="flex align-items-center" *ngIf="tableRowAutreDette.autresPrecisions">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{tableRowAutreDette.autresPrecisions.intitule}}</span>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center">
                <i class="pi pi-info-circle mr-2 text-orange-500"></i>
                <span>{{item.intitule}}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
        
        <!-- Ligne 3 - Champ unique sur toute la largeur -->
        <div class="field col-12 p-3">
          <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
            <i class="pi pi-file mr-2 text-orange-500"></i>Document (facultatif)
          </label>
          <div class="flex align-items-center gap-2">
            <button pButton 
                    icon="pi pi-upload" 
                    class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                    (click)="showUploadDialogForNewDette()" 
                    label="Ajouter un document">
            </button>
            <div *ngIf="tableRowAutreDette.fileName" class="ml-3 flex align-items-center bg-orange-50 p-2 border-round">
              <i class="pi pi-file text-orange-500 mr-2"></i>
              <span class="text-sm text-orange-500">{{ tableRowAutreDette.fileName }}</span>
              <button pButton icon="pi pi-times" 
                      class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                      pTooltip="Supprimer"
                      (click)="removeSelectedFiledette()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-center gap-3">
        <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddDette()"></button>
        <button pButton label="Ajouter" icon="pi pi-check" class="p-button-raised w-10rem" 
                style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;" 
                (click)="confirmAddDette()"></button>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Dialog pour upload de document -->
  <p-dialog header="Télécharger un document" 
           [(visible)]="displayUploadDialogdette" 
           [style]="{width: '450px'}" 
           [modal]="true" 
           [draggable]="false" 
           [resizable]="false"
           styleClass="custom-dialog">
    <ng-template pTemplate="header">
      <div class="w-full text-center" style="background: linear-gradient(to right, #ff7b00, #ff9e00);">
        <span class="text-white text-xl font-bold">Télécharger un document</span>
      </div>
    </ng-template>
    
    <div class="p-dialog-content">
      <div class="flex flex-column p-4 surface-card border-round-lg shadow-2">
        <label class="font-bold mb-2 text-900" style="background: linear-gradient(to right, #fff8f0, #ffeedd); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file-import mr-2 text-orange-500"></i>Sélectionner un fichier
        </label>
        <div class="p-field-file">
          <div class="py-3 px-4 border-1 border-dashed border-orange-500 border-round mb-2 text-center cursor-pointer hover:bg-orange-50 transition-colors transition-duration-300" 
               (click)="fileUpload.nativeElement.click()" 
               (dragover)="$event.preventDefault()" 
               (drop)="handleFileDropdette($event)">
            <span class="flex flex-column align-items-center">
              <i class="pi pi-cloud-upload text-5xl text-orange-500 mb-2"></i>
              <span class="text-orange-500">Glisser et déposer un fichier ici ou cliquer pour parcourir</span>
              <span class="text-sm text-orange-300 mt-1">
                (.pdf, .doc, .docx, .jpg, .jpeg, .png) - max 5 MB
              </span>
            </span>
          </div>
          <input #filedetteUpload type="file" (change)="onFileSelectdette($event)" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                 style="display:none;" />
        </div>
        <div *ngIf="selectedFile" class="mt-3 flex align-items-center bg-orange-50 p-2 border-round">
          <i class="pi pi-file text-orange-500 mr-2"></i>
          <span class="text-orange-500">{{ selectedFile.name }}</span>
          <span class="text-sm text-orange-300 ml-2">({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)</span>
        </div>
      </div>
    </div>
     <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" 
              class="p-button-outlined p-button-secondary w-10rem" 
              (click)="displayUploadDialogdette = false; selectedFile = null;"></button>
      <button pButton label="Télécharger" icon="pi pi-upload" 
              class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #ff7b00, #ff9e00); border: none;"
              [disabled]="!selectedFile"
              (click)="onFileSelectdette({target: {files: [selectedFile]}})"></button>
    </div>
  </ng-template>
</p-dialog>
  <!-- Input file caché -->
  <input type="file" #filedetteUploadElement id="fileUpload" style="display:none" 
         (change)="onFileSelectdette($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>
<p-accordionTab header="Disponibilités en Banque" (onOpen)="loadDisponibilites()" (onClose)="resetBanqueFilter()">
  <div class="card mb-4 p-3 shadow-sm"> 
    <div class="flex justify-content-between align-items-center mb-3">
      <h3 class="m-0 text-xl font-medium text-primary">Liste des disponibilités bancaires</h3>
      <div class="flex gap-2">
        <button pButton icon="pi pi-plus"
                class="p-button-rounded p-button-success p-button-outlined"
                (click)="showAddFormDialogdispo()"
                title="Ajouter">
        </button>
        <button pButton icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-button-outlined"
                [disabled]="!selectedDisponibilites.length"
                (click)="confirmDeleteSelecteddispo()"
                title="Supprimer sélection">
        </button>

      </div>
    </div>

    <p-table [value]="disponibilitesTemp" 
            [rows]="10" 
            [paginator]="true" 
            [rowHover]="true" 
            selectionMode="multiple" 
            [(selection)]="selectedDisponibilites"
            styleClass="p-datatable-sm p-datatable-gridlines" 
            [responsive]="true"
            [rowsPerPageOptions]="[5,10,25,50]"
            [globalFilterFields]="['banque','numeroCompte','typeCompte']"
            #dtDispo>
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between align-items-center">
          <div>
            <p-dropdown [options]="banques" optionLabel="intitule" 
                      [(ngModel)]="selectedBanque" [showClear]="true"
                      placeholder="Filtrer par banque" (onChange)="filterByBanque()"
                      class="w-full md:w-14rem p-inputtext-sm"></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="text-base bg-primary-50">
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="banque">Banque <p-sortIcon field="banque"></p-sortIcon></th>
          <th pSortableColumn="numeroCompte">Numéro compte <p-sortIcon field="numeroCompte"></p-sortIcon></th>
          <th pSortableColumn="typeCompte">Type compte <p-sortIcon field="typeCompte"></p-sortIcon></th>
          <th pSortableColumn="soldeFCFA">Solde (FCFA) <p-sortIcon field="soldeFCFA"></p-sortIcon></th>
          <th pSortableColumn="dateSolde">Date solde <p-sortIcon field="dateSolde"></p-sortIcon></th>
          <th>Document</th>
          <th style="width: 8rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-dispo>
        <tr [class.editing-row]="dispo.editing">
          <td><p-tableCheckbox [value]="dispo"></p-tableCheckbox></td>
          
          <ng-container *ngIf="!dispo.editing">
            <td><span [class.font-medium]="true">{{ getIntitule(dispo.banque) }}</span></td>
            <td>{{ dispo.numeroCompte }}</td>
            <td>{{ getIntitule(dispo.typeCompte) }}</td>
            <td class="font-bold text-right">{{ dispo.soldeFCFA | currency:'FCFA':'symbol':'1.0-0' }}</td>
            <td>{{ dispo.dateSolde | date:'dd/MM/yyyy' }}</td>
            
            <td>
              <div class="flex align-items-center">
                <button *ngIf="dispo.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2"
                        (click)="triggerFileUploaddispo(dispo)"
                        pTooltip="{{dispo.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="!dispo.editing && dispo.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentdispo(dispo)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="dispo.hasDocument" class="document-name text-sm text-primary">
                  {{ dispo.fileName }}
                </span>
                <span *ngIf="!dispo.hasDocument" class="text-gray-500 text-sm">
                  {{ dispo.editing ? 'Cliquez sur ⬆️ pour ajouter un document' : 'Aucun document' }}
                </span>
              </div>
            </td>
            
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-pencil" 
                        class="p-button-rounded p-button-text p-button-sm"
                        pTooltip="Modifier"
                        (click)="startEditDisponibilite(dispo)"></button>
              </div>
            </td>
          </ng-container>

          <ng-container *ngIf="dispo.editing">
            <td>
              <p-dropdown [options]="banques" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="dispo.banque" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <input pInputText [(ngModel)]="dispo.numeroCompte" class="w-full p-inputtext-sm" />
            </td>
            <td>
              <p-dropdown [options]="typesCompte" optionLabel="intitule" [appendTo]="'body'" 
                        [(ngModel)]="dispo.typeCompte" class="w-full p-inputtext-sm"></p-dropdown>
            </td>
            <td>
              <div class="p-inputgroup">
                <span class="p-inputgroup-addon">FCFA</span>
                <input pInputText [(ngModel)]="dispo.soldeFCFA" type="number" class="w-full p-inputtext-sm" />
              </div>
            </td>
            <td>
              <p-calendar [(ngModel)]="dispo.dateSolde" [appendTo]="'body'"
                        [showIcon]="true" class="w-full p-inputtext-sm"></p-calendar>
            </td>
            <td>
              <div class="flex align-items-center">
                <button *ngIf="dispo.editing"
                        pButton icon="pi pi-upload" 
                        class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                        (click)="triggerFileUploaddispo(dispo)" 
                        pTooltip="{{dispo.hasDocument ? 'Remplacer le document' : 'Ajouter un document'}}">
                </button>
                
                <button *ngIf="dispo.hasDocument" 
                        pButton icon="pi pi-download" 
                        class="p-button-rounded p-button-text p-button-sm p-button-success mr-2"
                        (click)="downloadDocumentdispo(dispo)"
                        pTooltip="Télécharger le document"></button>
                
                <span *ngIf="dispo.hasDocument" class="document-name text-sm text-primary">
                  {{ dispo.fileName }}
                </span>
                <span *ngIf="!dispo.hasDocument" class="text-gray-500 text-sm">
                  Aucun document
                </span>
              </div>
            </td>
            <td>
              <div class="flex gap-1 justify-content-center">
                <button pButton icon="pi pi-check" 
                        class="p-button-rounded p-button-success p-button-text p-button-sm"
                        pTooltip="Enregistrer"
                        (click)="confirmSaveUpdatedDisponibilite(dispo)"></button>
                <button pButton icon="pi pi-times" 
                        class="p-button-rounded p-button-danger p-button-text p-button-sm"
                        pTooltip="Annuler"
                        (click)="cancelEditDisponibilite(dispo)"></button>
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="flex flex-column align-items-center p-4">
              <i class="pi pi-credit-card text-6xl text-gray-400 mb-3"></i>
              <span class="text-gray-600">Aucune disponibilité bancaire trouvée</span>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="paginatorleft">
        <span class="text-sm text-gray-600">
          Total: {{disponibilitesTemp ? disponibilitesTemp.length : 0}} comptes
        </span>
      </ng-template>
    </p-table>
  </div>
  
  <input type="file" #filedispoUpload id="filedispoUpload" style="display:none" 
         (change)="onFileSelectdispo($event)" 
         accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
</p-accordionTab>

<p-dialog class="disponibilites-dialog"
  header="Ajouter une nouvelle disponibilité bancaire" 
  [(visible)]="displayAddDialogDispo"  
  [modal]="true"
  [draggable]="false" 
  [resizable]="false"
  [style]="{
    width: '70vw', 
    maxWidth: '800px', 
    fontSize: '1.2rem', 
    borderRadius: '16px',
  }"
  styleClass="p-3 surface-ground text-color border-round-xl"
  [baseZIndex]="10000">

  <ng-template pTemplate="header">
    <div class="w-full text-center py-4 px-2 border-round-top-xl shadow-2">
      <span class="text-black text-xl font-bold tracking-wide">Ajouter une nouvelle disponibilité bancaire</span>
    </div>
  </ng-template>

  <div class="p-dialog-content">
    <div class="formgrid grid p-4 surface-card border-round-lg shadow-2">
      <!-- Ligne 1 - Banque et Type de compte -->
      <div class="field col-12 md:col-6 p-3">
        <label for="banqueDispo" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-building mr-2 text-blue-500"></i>Banque<span class="text-danger">*</span>
        </label>
        <p-dropdown id="banqueDispo"
                  [options]="banques" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowDisponibilite.banque" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowDisponibilite.banque ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowDisponibilite.banque">
              <i class="pi pi-building mr-2 text-blue-500"></i>
              <span>{{tableRowDisponibilite.banque.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-building mr-2 text-blue-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowDisponibilite.banque" class="p-error block mt-1">La banque est requise</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="typeCompteDispo" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-credit-card mr-2 text-blue-500"></i>Type de compte<span class="text-danger">*</span>
        </label>
        <p-dropdown id="typeCompteDispo"
                  [options]="typesCompte" 
                  optionLabel="intitule" 
                  [(ngModel)]="tableRowDisponibilite.typeCompte" 
                  placeholder="Sélectionner" 
                  [required]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowDisponibilite.typeCompte ? '#f87171' : '', 'height': '40px'}">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center" *ngIf="tableRowDisponibilite.typeCompte">
              <i class="pi pi-credit-card mr-2 text-blue-500"></i>
              <span>{{tableRowDisponibilite.typeCompte.intitule}}</span>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center">
              <i class="pi pi-credit-card mr-2 text-blue-500"></i>
              <span>{{item.intitule}}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small *ngIf="submitted && !tableRowDisponibilite.typeCompte" class="p-error block mt-1">Le type de compte est requis</small>
      </div>

      <!-- Ligne 2 - Numéro de compte et Date du solde -->
      <div class="field col-12 md:col-6 p-3">
        <label for="numeroCompteDispo" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-id-card mr-2 text-blue-500"></i>Numéro de compte<span class="text-danger">*</span>
        </label>
        <input id="numeroCompteDispo" pInputText [(ngModel)]="tableRowDisponibilite.numeroCompte" class="w-full" 
               style="height: 40px;"
               [ngClass]="{'p-invalid': submitted && !tableRowDisponibilite.numeroCompte}" />
        <small *ngIf="submitted && !tableRowDisponibilite.numeroCompte" class="p-error block mt-1">Le numéro de compte est requis</small>
      </div>
      
      <div class="field col-12 md:col-6 p-3">
        <label for="dateSoldeDispo" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-calendar mr-2 text-blue-500"></i>Date du solde<span class="text-danger">*</span>
        </label>
        <p-calendar id="dateSoldeDispo"
                  [(ngModel)]="tableRowDisponibilite.dateSolde" 
                  [appendTo]="'body'"
                  [showIcon]="true" 
                  class="w-full"
                  [style]="{'border-color': submitted && !tableRowDisponibilite.dateSolde ? '#f87171' : '', 'height': '40px'}"></p-calendar>
        <small *ngIf="submitted && !tableRowDisponibilite.dateSolde" class="p-error block mt-1">La date du solde est requise</small>
      </div>

      <!-- Ligne 3 - Solde -->
      <div class="field col-12 p-3">
        <label for="soldeDispo" class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-money-bill mr-2 text-blue-500"></i>Solde (FCFA)<span class="text-danger">*</span>
        </label>
        <div class="p-inputgroup" style="height: 40px;">
          <span class="p-inputgroup-addon" style="background: linear-gradient(to right, #007bff, #00a1ff); color: white;">FCFA</span>
          <input id="soldeDispo" pInputText [(ngModel)]="tableRowDisponibilite.soldeFCFA" type="number" min="0" class="w-full" style="height: 40px;"
                 [ngClass]="{'p-invalid': submitted && !tableRowDisponibilite.soldeFCFA}" />
        </div>
        <small *ngIf="submitted && !tableRowDisponibilite.soldeFCFA" class="p-error block mt-1">Le solde est requis</small>
      </div>

      <!-- Ligne 4 - Documents -->
      <div class="field col-12 p-3">
        <label class="font-bold mb-2 block text-900" style="background: linear-gradient(to right, #f0f8ff, #ddeeff); padding: 0.5rem; border-radius: 6px;">
          <i class="pi pi-file mr-2 text-blue-500"></i>Document justificatif
        </label>
        <div class="flex align-items-center gap-2">
          <button pButton icon="pi pi-upload" 
                  class="p-button-rounded p-button-text p-button-sm p-button-info mr-2" 
                  (click)="triggerFileUploaddispo(tableRowDisponibilite)" 
                  label="Ajouter un document">
          </button>
          <div *ngIf="tableRowDisponibilite.fileName" class="ml-3 flex align-items-center bg-blue-50 p-2 border-round">
            <i class="pi pi-file text-blue-500 mr-2"></i>
            <span class="text-sm text-blue-500">{{ tableRowDisponibilite.fileName }}</span>
            <button pButton icon="pi pi-times" 
                    class="p-button-rounded p-button-text p-button-sm text-red-500 hover:bg-red-100 ml-2"
                    pTooltip="Supprimer"
                    (click)="removeSelectedFileDispo()"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-3">
      <button pButton label="Annuler" icon="pi pi-times" class="p-button-outlined p-button-secondary w-10rem" (click)="cancelAddDispo()"></button>
      <button pButton label="Enregistrer" icon="pi pi-check" class="p-button-raised w-10rem" 
              style="background: linear-gradient(to right, #007bff, #00a1ff); border: none;" 
              (click)="confirmAddDispo()"></button>
    </div>
  </ng-template>
</p-dialog>

<p-dialog header="Uploader un document" [(visible)]="displayUploadDialogDispo" [modal]="true" [style]="{width: '450px'}">
  <div class="p-fluid">
    <div class="field">
      <label for="file">Sélectionner un fichier (PDF, DOC, DOCX, JPG, PNG)</label>
      <p-fileUpload #fileUpload mode="basic" name="file" [maxFileSize]="5000000" 
                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" 
                   (onSelect)="onFileSelectdispo($event)" chooseLabel="Parcourir">
      </p-fileUpload>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Annuler" icon="pi pi-times" class="p-button-text" (click)="cancelUploaddispo()"></button>
    <button pButton label="Uploader" icon="pi pi-upload" class="p-button-primary" (click)="uploadFiledispo()"></button>
  </ng-template>
</p-dialog>







  <div class="flex justify-content-center gap-3 mt-6 mb-5">
    <button pButton label="Annuler la déclaration" icon="pi pi-times" 
            class="p-button-outlined p-button-danger p-button-lg" 
            style="min-width: 220px"></button>
            
            <button pButton label="Enregistrer la déclaration" icon="pi pi-save" 
            class="p-button-help p-button-lg" 
            style="min-width: 220px"
            (click)="saveDeclaration()"></button>
</div>